<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113235655-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?83434579b8f6b6a6c80fd1b4fe2d9afa"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="tyyr-WLO-Sq85TjMOOOHRRc5YD4W8if8mCXbUD_p_7k">
    
    
    <meta name="sogou_site_verification" content="PlW7T4UKFR">
    
    
    <meta name="baidu-site-verification" content="AdjyK6UssW">
    
    
    <meta name="msvalidate.01" content="BC20DDADC069448DFBCA67D9D7D57546">
    
    
    <meta name="360-site-verification" content="3addb98f1fb5f6b4d1ce03efc23bf5b8">
    
    
    
    <title>使用自签名证书，简单步骤 | 凝雨 - Yun | 快乐编程每一天 - Happy Coding Every Day</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="ssl,openssl,InstallCert">
    <meta name="description" content="使用自签名证书，简单步骤">
<meta name="keywords" content="ssl,openssl,InstallCert">
<meta property="og:type" content="article">
<meta property="og:title" content="使用自签名证书，简单步骤">
<meta property="og:url" content="https://ningyu1.github.io/20180112/52-ssl-cert-2.html">
<meta property="og:site_name" content="凝雨 - Yun">
<meta property="og:description" content="使用自签名证书，简单步骤">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ningyu1.github.io/img/ssl-cert/2.png">
<meta property="og:updated_time" content="2024-04-23T01:48:15.035Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="使用自签名证书，简单步骤">
<meta name="twitter:description" content="使用自签名证书，简单步骤">
<meta name="twitter:image" content="https://ningyu1.github.io/img/ssl-cert/2.png">
    
        <link rel="alternate" type="application/atom+xml" title="凝雨 - Yun" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">凝雨</h5>
          <a href="mailto:ningbe111@163.com" title="ningbe111@163.com" class="mail">ningbe111@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives/"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ningyu1" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                Rss
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://g2.okk.dog/?path=register&code=qn7nOwdj" target="_blank" >
                <i class="icon icon-lg icon-rocket"></i>
                科学上网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">使用自签名证书，简单步骤</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">使用自签名证书，简单步骤</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-01-12T11:13:36.000Z" itemprop="datePublished" class="page-time">
  2018-01-12
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ssl/">ssl</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>文章目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#通过InstallCert源码安装证书"><span class="post-toc-number">1.</span> <span class="post-toc-text">通过InstallCert源码安装证书</span></a></li></ol>
        </nav>
    </aside>


<article id="post-52-ssl-cert-2"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">使用自签名证书，简单步骤</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-01-12 19:13:36" datetime="2018-01-12T11:13:36.000Z"  itemprop="datePublished">2018-01-12</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ssl/">ssl</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>在前文<a href="https://ningyu1.github.io/site/post/51-ssl-cert/">《Openssl生成自签名证书，简单步骤》</a>中讲述了如何生成自签名证书，接下来整理证书使用遇到的问题。</p>
<p>证书使用的方式也有很多中，可以使用keytool生成或导入导出证书，这里对keytool不做过多描述，可以通过–help查看使用方法。</p>
<p>证书文件可以放到应用服务器、负载均衡、jvm中使用，如：IIS、tomcat、nginx或者loadbalance、jdk等等。</p>
<p>这里介绍一个简单的工具：<code>InstallCert</code>安装证书文件到jdk下，这个在本地调试连接ssl服务器代码的时候很有用。</p>
<p>如果我们的服务端使用的是jdk1.8（比如说：cas服务），访问的客户端（业务系统）也是jdk1.8，那么直接使用<code>InstallCert</code>安装即可.</p>
<p>如果我们的服务端使用的是jdk1.8，但是客户端使用jdk1.7会遇到什么问题？</p>
<p>我们都知道jdk1.7默认的TLS版本是1.0但是支持1.1和1.2，如何查看jdk支持的TLS版本呢？</p>
<p>可以使用jdk自带的<code>jcp（java control panel）</code>工具</p>
<p><code>jcp（java control panel）</code>路径：<code>%JAVA_HOME%\jre\bin</code></p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/ssl-cert/2.png" alt title>
                </div>
                <div class="image-caption"></div>
            </figure>
<p>点击高级，勾选TLS1.1 TSL1.2开启支持。</p>
<p>如果使用客户端程序（jdk1.7开发的）访问服务端程序（jdk1.8开发的），在使用<code>InstallCert</code>安装证书时会出现如下错误：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake</span><br><span class="line">    at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:946) ~[na:1.7.0_45]</span><br><span class="line">    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312) ~[na:1.7.0_45]</span><br></pre></td></tr></table></figure>
<p>上面错误的意思就是服务器把你拒绝了！把你拒绝了！把你拒绝了！拒绝你的理由就是TLS版本不对。</p>
<p>下面我主要讲在客户端程序（jdk1.7开发的）访问服务端程序（jdk1.8开发的）的场景下安装证书如何解决上面的错误。</p>
<h1 id="通过InstallCert源码安装证书"><a href="#通过InstallCert源码安装证书" class="headerlink" title="通过InstallCert源码安装证书"></a>通过InstallCert源码安装证书</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">/*</span><br><span class="line"> * Copyright 2006 Sun Microsystems, Inc.  All Rights Reserved.</span><br><span class="line"> *</span><br><span class="line"> * Redistribution and use in source and binary forms, with or without</span><br><span class="line"> * modification, are permitted provided that the following conditions</span><br><span class="line"> * are met:</span><br><span class="line"> *</span><br><span class="line"> *   - Redistributions of source code must retain the above copyright</span><br><span class="line"> *     notice, this list of conditions and the following disclaimer.</span><br><span class="line"> *</span><br><span class="line"> *   - Redistributions in binary form must reproduce the above copyright</span><br><span class="line"> *     notice, this list of conditions and the following disclaimer in the</span><br><span class="line"> *     documentation and/or other materials provided with the distribution.</span><br><span class="line"> *</span><br><span class="line"> *   - Neither the name of Sun Microsystems nor the names of its</span><br><span class="line"> *     contributors may be used to endorse or promote products derived</span><br><span class="line"> *     from this software without specific prior written permission.</span><br><span class="line"> *</span><br><span class="line"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS</span><br><span class="line"> * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,</span><br><span class="line"> * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span><br><span class="line"> * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR</span><br><span class="line"> * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span><br><span class="line"> * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span><br><span class="line"> * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span><br><span class="line"> * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span><br><span class="line"> * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span><br><span class="line"> * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span><br><span class="line"> * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.net.URL;</span><br><span class="line"></span><br><span class="line">import java.security.*;</span><br><span class="line">import java.security.cert.*;</span><br><span class="line"></span><br><span class="line">import javax.net.ssl.*;</span><br><span class="line"></span><br><span class="line">public class InstallCert &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">    String host;</span><br><span class="line">    int port;</span><br><span class="line">    char[] passphrase;</span><br><span class="line">    if ((args.length == 1) || (args.length == 2)) &#123;</span><br><span class="line">        String[] c = args[0].split(&quot;:&quot;);</span><br><span class="line">        host = c[0];</span><br><span class="line">        port = (c.length == 1) ? 443 : Integer.parseInt(c[1]);</span><br><span class="line">        String p = (args.length == 1) ? &quot;changeit&quot; : args[1];</span><br><span class="line">        passphrase = p.toCharArray();</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        System.out.println(&quot;Usage: java InstallCert &lt;host&gt;[:port] [passphrase]&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    File file = new File(&quot;jssecacerts&quot;);</span><br><span class="line">    if (file.isFile() == false) &#123;</span><br><span class="line">        char SEP = File.separatorChar;</span><br><span class="line">        File dir = new File(System.getProperty(&quot;java.home&quot;) + SEP</span><br><span class="line">            + &quot;lib&quot; + SEP + &quot;security&quot;);</span><br><span class="line">        file = new File(dir, &quot;jssecacerts&quot;);</span><br><span class="line">        if (file.isFile() == false) &#123;</span><br><span class="line">        file = new File(dir, &quot;cacerts&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;Loading KeyStore &quot; + file + &quot;...&quot;);</span><br><span class="line">    InputStream in = new FileInputStream(file);</span><br><span class="line">    KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">    ks.load(in, passphrase);</span><br><span class="line">    in.close();</span><br><span class="line"></span><br><span class="line">    SSLContext context = SSLContext.getInstance(&quot;TLSv1.2&quot;);</span><br><span class="line">    TrustManagerFactory tmf =</span><br><span class="line">        TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());</span><br><span class="line">    tmf.init(ks);</span><br><span class="line">    X509TrustManager defaultTrustManager = (X509TrustManager)tmf.getTrustManagers()[0];</span><br><span class="line">    SavingTrustManager tm = new SavingTrustManager(defaultTrustManager);</span><br><span class="line">    context.init(null, new TrustManager[] &#123;tm&#125;, null);</span><br><span class="line">    SSLSocketFactory factory = context.getSocketFactory();</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;Opening connection to &quot; + host + &quot;:&quot; + port + &quot;...&quot;);</span><br><span class="line">    SSLSocket socket = (SSLSocket)factory.createSocket(host, port);</span><br><span class="line">    socket.setSoTimeout(10000);</span><br><span class="line">    try &#123;</span><br><span class="line">        System.out.println(&quot;Starting SSL handshake...&quot;);</span><br><span class="line">        socket.startHandshake();</span><br><span class="line">        socket.close();</span><br><span class="line">        System.out.println();</span><br><span class="line">        System.out.println(&quot;No errors, certificate is already trusted&quot;);</span><br><span class="line">    &#125; catch (SSLException e) &#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">        e.printStackTrace(System.out);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    X509Certificate[] chain = tm.chain;</span><br><span class="line">    if (chain == null) &#123;</span><br><span class="line">        System.out.println(&quot;Could not obtain server certificate chain&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    BufferedReader reader =</span><br><span class="line">        new BufferedReader(new InputStreamReader(System.in));</span><br><span class="line"></span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println(&quot;Server sent &quot; + chain.length + &quot; certificate(s):&quot;);</span><br><span class="line">    System.out.println();</span><br><span class="line">    MessageDigest sha1 = MessageDigest.getInstance(&quot;SHA1&quot;);</span><br><span class="line">    MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;);</span><br><span class="line">    for (int i = 0; i &lt; chain.length; i++) &#123;</span><br><span class="line">        X509Certificate cert = chain[i];</span><br><span class="line">        System.out.println</span><br><span class="line">            (&quot; &quot; + (i + 1) + &quot; Subject &quot; + cert.getSubjectDN());</span><br><span class="line">        System.out.println(&quot;   Issuer  &quot; + cert.getIssuerDN());</span><br><span class="line">        sha1.update(cert.getEncoded());</span><br><span class="line">        System.out.println(&quot;   sha1    &quot; + toHexString(sha1.digest()));</span><br><span class="line">        md5.update(cert.getEncoded());</span><br><span class="line">        System.out.println(&quot;   md5     &quot; + toHexString(md5.digest()));</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;Enter certificate to add to trusted keystore or &apos;q&apos; to quit: [1]&quot;);</span><br><span class="line">    String line = reader.readLine().trim();</span><br><span class="line">    int k;</span><br><span class="line">    try &#123;</span><br><span class="line">        k = (line.length() == 0) ? 0 : Integer.parseInt(line) - 1;</span><br><span class="line">    &#125; catch (NumberFormatException e) &#123;</span><br><span class="line">        System.out.println(&quot;KeyStore not changed&quot;);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    X509Certificate cert = chain[k];</span><br><span class="line">    String alias = host + &quot;-&quot; + (k + 1);</span><br><span class="line">    ks.setCertificateEntry(alias, cert);</span><br><span class="line"></span><br><span class="line">    OutputStream out = new FileOutputStream(&quot;jssecacerts&quot;);</span><br><span class="line">    ks.store(out, passphrase);</span><br><span class="line">    out.close();</span><br><span class="line"></span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println(cert);</span><br><span class="line">    System.out.println();</span><br><span class="line">    System.out.println</span><br><span class="line">        (&quot;Added certificate to keystore &apos;jssecacerts&apos; using alias &apos;&quot;</span><br><span class="line">        + alias + &quot;&apos;&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static final char[] HEXDIGITS = &quot;0123456789abcdef&quot;.toCharArray();</span><br><span class="line"></span><br><span class="line">    private static String toHexString(byte[] bytes) &#123;</span><br><span class="line">    StringBuilder sb = new StringBuilder(bytes.length * 3);</span><br><span class="line">    for (int b : bytes) &#123;</span><br><span class="line">        b &amp;= 0xff;</span><br><span class="line">        sb.append(HEXDIGITS[b &gt;&gt; 4]);</span><br><span class="line">        sb.append(HEXDIGITS[b &amp; 15]);</span><br><span class="line">        sb.append(&apos; &apos;);</span><br><span class="line">    &#125;</span><br><span class="line">    return sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static class SavingTrustManager implements X509TrustManager &#123;</span><br><span class="line"></span><br><span class="line">    private final X509TrustManager tm;</span><br><span class="line">    private X509Certificate[] chain;</span><br><span class="line"></span><br><span class="line">    SavingTrustManager(X509TrustManager tm) &#123;</span><br><span class="line">        this.tm = tm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">//        throw new UnsupportedOperationException();</span><br><span class="line">        return new X509Certificate[0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void checkClientTrusted(X509Certificate[] chain, String authType)</span><br><span class="line">        throws CertificateException &#123;</span><br><span class="line">        throw new UnsupportedOperationException();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void checkServerTrusted(X509Certificate[] chain, String authType)</span><br><span class="line">        throws CertificateException &#123;</span><br><span class="line">        this.chain = chain;</span><br><span class="line">        tm.checkServerTrusted(chain, authType);</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面源码我修改了<code>SSLContext context = SSLContext.getInstance(&quot;TLSv1.2&quot;);</code>，原本是TLS，这样在jdk1.7下会报错，尽管加了vm参数：<code>-Dhttps.protocols=TLSv1.1,TLSv1.2 -Djava.net.preferIPv4Stack=true</code>，依然会报错。</p>
<p>修改为TLSv1.2后，直接运行代码，参数为：你需要签名的域名</p>
<p>运行日志会出现如下错误（不用紧张，这个错误没有关系）：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Opening connection to login.xxxxx.com.cn:443...</span><br><span class="line">Starting SSL handshake...</span><br><span class="line"></span><br><span class="line">javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884)</span><br><span class="line">	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276)</span><br><span class="line">	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153)</span><br><span class="line">	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)</span><br><span class="line">	at sun.security.ssl.Handshaker.process_record(Handshaker.java:804)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339)</span><br><span class="line">	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323)</span><br><span class="line">	at InstallCert.main(InstallCert.java:99)</span><br><span class="line">Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)</span><br><span class="line">	at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:292)</span><br><span class="line">	at sun.security.validator.Validator.validate(Validator.java:260)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:326)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:231)</span><br><span class="line">	at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:107)</span><br><span class="line">	at InstallCert$SavingTrustManager.checkServerTrusted(InstallCert.java:195)</span><br><span class="line">	at sun.security.ssl.AbstractTrustManagerWrapper.checkServerTrusted(SSLContextImpl.java:813)</span><br><span class="line">	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323)</span><br><span class="line">	... 8 more</span><br><span class="line">Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target</span><br><span class="line">	at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:196)</span><br><span class="line">	at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:268)</span><br><span class="line">	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)</span><br><span class="line">	... 16 more</span><br><span class="line"></span><br><span class="line">Server sent 1 certificate(s):</span><br><span class="line"></span><br><span class="line"> 1 Subject EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN</span><br><span class="line">   Issuer  EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN</span><br><span class="line">   sha1    18 fe a4 26 de 9f ef 9f d0 12 f9 1b da e8 f4 6e 46 a3 ca e2 </span><br><span class="line">   md5     53 02 53 bc 1f 5d e3 0f c2 ce a5 fa 43 7b 53 83 </span><br><span class="line"></span><br><span class="line">Enter certificate to add to trusted keystore or &apos;q&apos; to quit: [1]</span><br></pre></td></tr></table></figure>
<p>出现上面错误没关系，在命令行输入：1，生成文件，会在执行目录下生成：jssecacerts，并且会输出下面的日志：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Enter certificate to add to trusted keystore or &apos;q&apos; to quit: [1]</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">[</span><br><span class="line">[</span><br><span class="line">  Version: V1</span><br><span class="line">  Subject: EMAILADDRESS=ningyu@xxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN</span><br><span class="line">  Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11</span><br><span class="line"></span><br><span class="line">  Key:  Sun RSA public key, 1024 bits</span><br><span class="line">  modulus: 150111273197244637724411949927732292545940427223472330318676441758610292860528090849280500452765059055376192276098938042951946335160244351904122898746077164287399465663417510841977938344538423662939325238497292924898237072606839002269269847753256718676717424760603548961942760492908854629736493402902120207483</span><br><span class="line">  public exponent: 65537</span><br><span class="line">  Validity: [From: Fri Jan 12 15:15:03 CST 2018,</span><br><span class="line">               To: Mon Jan 10 15:15:03 CST 2028]</span><br><span class="line">  Issuer: EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN</span><br><span class="line">  SerialNumber: [    b9c6224c 0cf5ee1a]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">  Algorithm: [SHA256withRSA]</span><br><span class="line">  Signature:</span><br><span class="line">0000: B7 F8 1B FB 3C 7E 46 31   9C 56 31 47 F5 79 2C AA  ....&lt;.F1.V1G.y,.</span><br><span class="line">0010: B0 E3 FB EA CF 6C 15 72   53 8B A9 36 1D 43 E0 AB  .....l.rS..6.C..</span><br><span class="line">0020: 21 3C BD 65 51 11 B3 D6   5B 42 40 DB 07 9C 35 5C  !&lt;.eQ...[B@...5\</span><br><span class="line">0030: 84 9B B7 B8 02 5A E0 96   5D 5F 9E 5D B3 5F 85 A8  .....Z..]_.]._..</span><br><span class="line">0040: 50 64 63 E7 12 B0 DF CA   48 DD 28 B7 B2 8D 42 33  Pdc.....H.(...B3</span><br><span class="line">0050: A5 C1 E8 E1 41 08 F8 39   21 DD 6C BE 6E F1 CD EE  ....A..9!.l.n...</span><br><span class="line">0060: F9 C0 DC 2F 1E 99 D2 DC   A3 2C C7 C2 64 ED 94 5E  .../.....,..d..^</span><br><span class="line">0070: 32 6F CC B4 3D 93 B7 F8   09 8D F9 4E 39 CA 5E 53  2o..=......N9.^S</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">Added certificate to keystore &apos;jssecacerts&apos; using alias &apos;login.xxxxxx.com-1&apos;</span><br></pre></td></tr></table></figure>
<p>这个时候再运行一遍<code>InstallCert</code>就不会报错，因为已经有jssecacerts文件，直接copy jssecacerts文件到%JAVA_HOME%\jre\lib\security下，就可以愉快的玩耍了。</p>
<p>这个在我们本地调试连接ssl服务器的代码时很有用，如果不把证书放入jdk下你会被无限的拒绝。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-23T01:48:15.035Z" itemprop="dateUpdated">2024-04-23 09:48:15</time>
</span><br>


        
        原始链接：<a href="/20180112/52-ssl-cert-2.html" target="_blank" rel="external">https://ningyu1.github.io/20180112/52-ssl-cert-2.html</a><br>版权声明：本文由 <strong>凝雨-Yun</strong> 原创，采用<strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a></strong>进行许可。 <br><strong>转载请注明作者及出处！</strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        
    </div>
    
    <footer>
        <a href="https://ningyu1.github.io">
            <img src="/img/avatar.jpg" alt="凝雨">
            凝雨
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/InstallCert/">InstallCert</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/openssl/">openssl</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ssl/">ssl</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&title=《使用自签名证书，简单步骤》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&title=《使用自签名证书，简单步骤》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20180112/52-ssl-cert-2.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《使用自签名证书，简单步骤》 — 凝雨 - Yun&url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/20180115/53-ssl-cert-3.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Java访问SSL地址，使用证书方式和免验证证书方式</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/20180112/51-ssl-cert.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Openssl生成自签名证书，简单步骤</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '298f0d78bd14c9c0ff01',
          clientSecret: 'e81e4d36caf1a13d2f05ed5dcf30e636dde749ac',
          repo: 'blog',
          owner: 'ningyu1',
          admin: ['ningyu1'],
          id: id,      // Ensure uniqueness and length less than 50
	  //id: 'Comments',
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        可以吃个鸡腿吗？
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.zh">知识共享署名-相同方式共享 4.0 国际许可协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>凝雨 &copy; 2016 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&title=《使用自签名证书，简单步骤》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&title=《使用自签名证书，简单步骤》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20180112/52-ssl-cert-2.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《使用自签名证书，简单步骤》 — 凝雨 - Yun&url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20180112/52-ssl-cert-2.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACOElEQVR42u3aS5KDMAxFUfa/aTLNxM59MqTK8vUo1aHBh4Fifa4Lr/trkW/n19ee8sCSIUPGtox7ukbXzO9Avq09d0iVIUPGAYxRBBt9JrcebYtfQ/YmQ4YMGenj+V9qbBkyZMjgAXf+v+T+PBmWIUOGDJ5M8jA6D6mkVvZiLi5DhowNGTwU/v/zK/0NGTJkbMW4w5X+V1o+qy0ZMmT0ZqSJaO3guDIdEYxlyJAhoymj1mJ8b8ArTX2XOqUyZMjYivFwgX6a+vLRsSCsy5AhozWDlL1IEOQpa5ri8tckQ4aMcxi1OnzthJaOiP14uTJkyDiAUUtfa20AErhJ0L9StwwZMjZk1I5ltaIYb4jGDQkZMmS0ZtQOfLz0xo+PaTgehmAZMmS0ZqyX79OAy8t5S6ddGTJktGDMA1k6NsF5/Fno6TJkyGjNSFPNNMlMN7pyjQwZMroy0pIWT1Zrx8daiitDhoyujHTwiw+H8QYnL94NfxJkyJDRmsFLbMVYDsJ02hyNOxsyZMhox1jZChmhSJNk3tSUIUPGyYxawCUJLW8koB8DGTJkHMDgn58t0l3h+hFwZciQ0Y5xh4tvIj3q8eNjMN8hQ4aMFozagY8E33S7PDFOX5MMGTJ6MEiQTbeeYtZfigwZMk5g8Kx3paDGS2xx6JchQ4aMsNzG084gpK5PeciQIeMwBr9PrZFJmgoPBFwZMmRsxUiPd+khstZIeKXcJkOGjA0ZK5MaJFlNi258TE2GDBkHMD5QBUuphZMZMQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-indigo-patch@1.0.0/source/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
