<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113235655-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?83434579b8f6b6a6c80fd1b4fe2d9afa"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="tyyr-WLO-Sq85TjMOOOHRRc5YD4W8if8mCXbUD_p_7k">
    
    
    <meta name="sogou_site_verification" content="PlW7T4UKFR">
    
    
    <meta name="baidu-site-verification" content="AdjyK6UssW">
    
    
    <meta name="msvalidate.01" content="BC20DDADC069448DFBCA67D9D7D57546">
    
    
    <meta name="360-site-verification" content="3addb98f1fb5f6b4d1ce03efc23bf5b8">
    
    
    
    <title>Webpack 打包优化之速度篇 | 凝雨 - Yun | 快乐编程每一天 - Happy Coding Every Day</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Webpack,Vue,React,Angular">
    <meta name="description" content="Webpack 打包优化之速度篇">
<meta name="keywords" content="Webpack,Vue,React,Angular">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack 打包优化之速度篇">
<meta property="og:url" content="https://ningyu1.github.io/20170920/27-webpack2.html">
<meta property="og:site_name" content="凝雨 - Yun">
<meta property="og:description" content="Webpack 打包优化之速度篇">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ningyu1.github.io/img/webpack/1.png">
<meta property="og:image" content="https://ningyu1.github.io/img/webpack/3.png">
<meta property="og:image" content="https://ningyu1.github.io/img/webpack/4.png">
<meta property="og:updated_time" content="2024-04-23T01:48:15.032Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Webpack 打包优化之速度篇">
<meta name="twitter:description" content="Webpack 打包优化之速度篇">
<meta name="twitter:image" content="https://ningyu1.github.io/img/webpack/1.png">
    
        <link rel="alternate" type="application/atom+xml" title="凝雨 - Yun" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">凝雨</h5>
          <a href="mailto:ningbe111@163.com" title="ningbe111@163.com" class="mail">ningbe111@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives/"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ningyu1" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                Rss
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://g2.okk.dog/?path=register&code=qn7nOwdj" target="_blank" >
                <i class="icon icon-lg icon-rocket"></i>
                科学上网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Webpack 打包优化之速度篇</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Webpack 打包优化之速度篇</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-09-20T03:57:36.000Z" itemprop="datePublished" class="page-time">
  2017-09-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/">Webpack</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/">Vue</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/React/">React</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/React/Angular/">Angular</a></li></ul></li></ul></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>文章目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#减小文件搜索范围"><span class="post-toc-number">1.</span> <span class="post-toc-text">减小文件搜索范围</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#配置-resolve-modules"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">配置 resolve.modules</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#设置-test-amp-include-amp-exclude"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">设置 test &amp; include &amp; exclude</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#增强代码代码压缩工具"><span class="post-toc-number">2.</span> <span class="post-toc-text">增强代码代码压缩工具</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#用-Happypack-来加速代码构建"><span class="post-toc-number">3.</span> <span class="post-toc-text">用 Happypack 来加速代码构建</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置-babel-的-cacheDirectory-为true"><span class="post-toc-number">4.</span> <span class="post-toc-text">设置 babel 的 cacheDirectory 为true</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#设置-noParse"><span class="post-toc-number">5.</span> <span class="post-toc-text">设置 noParse</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#拷贝静态文件"><span class="post-toc-number">6.</span> <span class="post-toc-text">拷贝静态文件</span></a></li></ol>
        </nav>
    </aside>


<article id="post-27-webpack2"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Webpack 打包优化之速度篇</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-09-20 11:57:36" datetime="2017-09-20T03:57:36.000Z"  itemprop="datePublished">2017-09-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/">Webpack</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/">Vue</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/React/">React</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Webpack/Vue/React/Angular/">Angular</a></li></ul></li></ul></li></ul></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>文章来源：<a href="https://jeffjade.com/2017/08/12/125-webpack-package-optimization-for-speed/" target="_blank" rel="noopener">https://jeffjade.com/2017/08/12/125-webpack-package-optimization-for-speed/</a><br>作者：@晚晴幽草轩轩主</p>
<p>在前文 <a href="https://ningyu1.github.io/site/post/26-webpack1/">Webpack 打包优化之体积</a>篇中，对如何减小 <code>Webpack</code> 打包体积，做了些探讨；当然，那些法子对于打包速度的提升，也是大有裨益。然而，打包速度之于<strong>开发体验</strong>和<strong>及时构建</strong>，相当重要；所以有必要对其做更为深入的研究，以便完善工作流，这就是本文存在的缘由。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/webpack/1.png" alt="Webpack Package optimization" title>
                </div>
                <div class="image-caption">Webpack Package optimization</div>
            </figure>
<center><em>Webpack Package optimization</em></center>

<h2 id="减小文件搜索范围"><a href="#减小文件搜索范围" class="headerlink" title="减小文件搜索范围"></a>减小文件搜索范围</h2><p>在使用实际项目开发中，为了提升开发效率，很明显你会使用很多成熟第三方库；即便自己写的代码，模块间相互引用，为了方便也会使用相对路劲，或者别名(<code>alias</code>)；这中间如果能使得 <code>Webpack</code> 更快寻找到目标，将对打包速度产生很是积极的影响。于此，我们需要做的即：减小文件搜索范围，从而提升速度；实现这一点，可以有如下两法：</p>
<h3 id="配置-resolve-modules"><a href="#配置-resolve-modules" class="headerlink" title="配置 resolve.modules"></a>配置 resolve.modules</h3><p><code>Webpack</code>的<code>resolve.modules</code>配置模块库（即 node_modules）所在的位置，在 js 里出现 <code>import &#39;vue&#39;</code> 这样不是相对、也不是绝对路径的写法时，会去 <code>node_modules</code> 目录下找。但是默认的配置，会采用向上递归搜索的方式去寻找，但通常项目目录里只有一个 <code>node_modules</code>，且是在项目根目录，为了减少搜索范围，可以直接写明 <code>node_modules</code> 的全路径；同样，对于别名(<code>alias</code>)的配置，亦当如此：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">function resolve (dir) &#123;</span><br><span class="line">  return path.join(__dirname, &apos;..&apos;, dir)</span><br><span class="line">&#125;</span><br><span class="line">module.exports = &#123;</span><br><span class="line">  resolve: &#123;</span><br><span class="line">    extensions: [&apos;.js&apos;, &apos;.vue&apos;, &apos;.json&apos;],</span><br><span class="line">    modules: [</span><br><span class="line">      resolve(&apos;src&apos;),</span><br><span class="line">      resolve(&apos;node_modules&apos;)</span><br><span class="line">    ],</span><br><span class="line">    alias: &#123;</span><br><span class="line">      &apos;vue$&apos;: &apos;vue/dist/vue.common.js&apos;,</span><br><span class="line">      &apos;src&apos;: resolve(&apos;src&apos;),</span><br><span class="line">      &apos;assets&apos;: resolve(&apos;src/assets&apos;),</span><br><span class="line">      &apos;components&apos;: resolve(&apos;src/components&apos;),</span><br><span class="line">      // ...</span><br><span class="line">      &apos;store&apos;: resolve(&apos;src/store&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>需要额外补充一点的是，这是 Webpack2.<em> 以上的写法。在 1.</em> 版本中，使用的是 <code>resolve.root</code>，如今已经被弃用为 <code>resolve.modules</code>；同时被弃用的还有<code>resolve.fallback</code>、<code>resolve.modulesDirectories</code>。</p>
<h3 id="设置-test-amp-include-amp-exclude"><a href="#设置-test-amp-include-amp-exclude" class="headerlink" title="设置 test &amp; include &amp; exclude"></a>设置 test &amp; include &amp; exclude</h3><p><code>Webpack</code> 的装载机(loaders)，允许每个子项都可以有以下属性：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">test：必须满足的条件（正则表达式，不要加引号，匹配要处理的文件）</span><br><span class="line">exclude：不能满足的条件（排除不处理的目录）</span><br><span class="line">include：导入的文件将由加载程序转换的路径或文件数组（把要处理的目录包括进来）</span><br><span class="line">loader：一串“！”分隔的装载机（2.0版本以上，”-loader”不可以省略）</span><br><span class="line">loaders：作为字符串的装载器阵列</span><br></pre></td></tr></table></figure>
<p>对于<code>include</code>，更精确指定要处理的目录，这可以减少不必要的遍历，从而减少性能损失。同样，对于已经明确知道的，不需要处理的目录，则应该予以排除，从而进一步提升性能。假设你有一个第三方组件的引用，它肯定位于<code>node_modules</code>，通常它将有一个 <code>src</code> 和一个 <code>dist</code> 目录。如果配置 <code>Webpack</code> 来排除 <code>node_modules</code>，那么它将从 <code>dist</code> 已经编译的目录中获取文件。否则会再次编译它们。故而，合理的设置 <code>include</code> &amp; <code>exclude</code>，将会极大地提升 <code>Webpack</code> 打包优化速度，比如像这样：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">  preLoaders: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.js$/,</span><br><span class="line">      loader: &apos;eslint&apos;,</span><br><span class="line">      include: [resolve(&apos;src&apos;)],</span><br><span class="line">      exclude: /node_modules/</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.svg$/,</span><br><span class="line">      loader: &apos;svgo?&apos; + JSON.stringify(svgoConfig)，</span><br><span class="line">      include: [resolve(&apos;src/assets/icons&apos;)],</span><br><span class="line">      exclude: /node_modules/</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  loaders: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.vue$/,</span><br><span class="line">      loader: &apos;vue-loader&apos;,</span><br><span class="line">      include: [resolve(&apos;src&apos;)],</span><br><span class="line">      exclude: /node_modules\/(?!(autotrack|dom-utils))|vendor\.dll\.js/</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.(png|jpe?g|gif|svg)(\?.*)?$/,</span><br><span class="line">      loader: &apos;url&apos;,</span><br><span class="line">      exclude: /assets\/icons/,</span><br><span class="line">      query: &#123;</span><br><span class="line">        limit: 10000,</span><br><span class="line">        name: utils.assetsPath(&apos;img/[name].[hash:7].[ext]&apos;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="增强代码代码压缩工具"><a href="#增强代码代码压缩工具" class="headerlink" title="增强代码代码压缩工具"></a>增强代码代码压缩工具</h2><p><code>Webpack</code> 默认提供的 <code>UglifyJS</code> 插件，由于采用单线程压缩，速度颇慢 ；推荐采用 <code>webpack-parallel-uglify-plugin</code> 插件，她可以并行运行 <code>UglifyJS</code> 插件，更加充分而合理的使用 <code>CPU</code> 资源，这可以大大减少的构建时间；当然，该插件应用于生产环境而非开发环境，其做法如下，</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">new webpack.optimize.UglifyJsPlugin(&#123;</span><br><span class="line">  compress: &#123;</span><br><span class="line">    warnings: false</span><br><span class="line">  &#125;,</span><br><span class="line">  sourceMap: true</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>替换如上自带的 <code>UglifyJsPlugin</code> 写法为如下配置即可：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var ParallelUglifyPlugin = require(&apos;webpack-parallel-uglify-plugin&apos;);</span><br><span class="line">new ParallelUglifyPlugin(&#123;</span><br><span class="line">  cacheDir: &apos;.cache/&apos;,</span><br><span class="line">  uglifyJS:&#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">      comments: false</span><br><span class="line">    &#125;,</span><br><span class="line">    compress: &#123;</span><br><span class="line">      warnings: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>当然也有其他同类型的插件，比如：<a href="https://www.npmjs.com/package/webpack-uglify-parallel" target="_blank" rel="noopener">webpack-uglify-parallel</a>，但根据自己实践效果来看，并没有 <code>webpack-parallel-uglify-plugin</code> 表现的那么卓越，有兴趣的朋友，可以更全面的做下对比，择优选用。需要额外说明的是，<code>webpack-parallel-uglify-plugin</code> 插件的运用，会相对 <code>UglifyJsPlugin</code> 打出的包，看起来略大那么一丢丢(其实可以忽略不计)；如果在你使用时也是如此，那么在打包速度跟包体积之间，你应该有自己的抉择。</p>
<h2 id="用-Happypack-来加速代码构建"><a href="#用-Happypack-来加速代码构建" class="headerlink" title="用 Happypack 来加速代码构建"></a>用 Happypack 来加速代码构建</h2><p>你知道，<code>Webpack</code> 中为了方便各种资源和类型的加载，设计了以 <code>loader</code> 加载器的形式读取资源，但是受限于 <code>nodejs</code> 的编程模型影响，所有的 <code>loader</code> 虽然以 <code>async</code> 的形式来并发调用，但是还是运行在单个 <code>node</code> 的进程，以及在同一个事件循环中，这就直接导致了些问题：当同时读取多个<code>loader</code>文件资源时，比如<code>babel-loader</code>需要 <code>transform</code> 各种<code>jsx</code>，<code>es6</code>的资源文件。在这种同步计算同时需要大量耗费 <code>cpu</code> 运算的过程中，<code>node</code>的单进程模型就无优势了，而 <code>Happypack</code> 就是针对解决此类问题而生的存在。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/webpack/3.png" alt="Webpack-Happypack" title>
                </div>
                <div class="image-caption">Webpack-Happypack</div>
            </figure>
<center><em>Webpack-Happypack</em></center>

<p><code>Happypack</code> 的处理思路是：将原有的 <code>webpack</code> 对 <code>loader</code> 的执行过程，从单一进程的形式扩展多进程模式，从而加速代码构建；原本的流程保持不变，这样可以在不修改原有配置的基础上，来完成对编译过程的优化，具体配置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var HappyPack = require(&apos;happypack&apos;);</span><br><span class="line">var happyThreadPool = HappyPack.ThreadPool(&#123; size: os.cpus().length &#125;);</span><br><span class="line">module: &#123;</span><br><span class="line">  loaders: [</span><br><span class="line">    &#123;</span><br><span class="line">      test: /\.js[x]?$/,</span><br><span class="line">      include: [resolve(&apos;src&apos;)],</span><br><span class="line">      exclude: /node_modules/,</span><br><span class="line">      loader: &apos;happypack/loader?id=happybabel&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;,</span><br><span class="line">plugins: [</span><br><span class="line">  new HappyPack(&#123;</span><br><span class="line">    id: &apos;happybabel&apos;,</span><br><span class="line">    loaders: [&apos;babel-loader&apos;],</span><br><span class="line">    threadPool: happyThreadPool,</span><br><span class="line">    cache: true,</span><br><span class="line">    verbose: true</span><br><span class="line">  &#125;)</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>可以研究看到，通过在 <code>loader</code> 中配置直接指向 <code>happypack</code> 提供的 <code>loader</code>，对于文件实际匹配的处理 loader，则是通过配置在 plugin 属性来传递说明，这里 <code>happypack</code> 提供的 <code>loader</code> 与 <code>plugin</code> 的衔接匹配，则是通过<code>id=happybabel</code>来完成。配置完成后，<code>laoder</code>的工作模式就转变成了如下所示：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/webpack/4.png" alt="Webpack-Happypack" title>
                </div>
                <div class="image-caption">Webpack-Happypack</div>
            </figure>
<center><em>Webpack-Happypack</em></center>

<p><code>Happypack</code> 在编译过程中，除了利用多进程的模式加速编译，还同时开启了 <code>cache</code> 计算，能充分利用缓存读取构建文件，对构建的速度提升也是非常明显的；更多关于 <code>happyoack</code> 个中原理，可参见 @淘宝前端团队(FED) 的这篇：<a href="https://taobaofed.org/blog/2016/12/08/happypack-source-code-analysis/" target="_blank" rel="noopener">happypack 原理解析</a>。如果你使用的 <code>Vue.js</code> 框架来开发，也可参考 <a href="https://github.com/nicejade/vue-boilerplate-template/blob/master/build/webpack.base.conf.js" target="_blank" rel="noopener">vue-webpack-happypack</a> 相关配置。</p>
<h2 id="设置-babel-的-cacheDirectory-为true"><a href="#设置-babel-的-cacheDirectory-为true" class="headerlink" title="设置 babel 的 cacheDirectory 为true"></a>设置 babel 的 cacheDirectory 为true</h2><p><a href="https://github.com/babel/babel-loader" target="_blank" rel="noopener">babel-loader</a> is slow! 所以不仅要使用<code>exclude</code>、<code>include</code>，尽可能准确的指定要转化内容的范畴，而且要充分利用缓存，进一步提升性能。<code>babel-loader</code> 提供了 <code>cacheDirectory</code>特定选项（默认 <code>false</code>）：设置时，给定的目录将用于缓存加载器的结果。<br>未来的 <code>Webpack</code> 构建将尝试从缓存中读取，以避免在每次运行时运行潜在昂贵的 Babel 重新编译过程。如果值为空（<code>loader: ‘babel-loader?cacheDirectory’</code>）或<code>true（loader: babel-loader?cacheDirectory=true</code>），<code>node_modules/.cache/babel-loader</code> 则 <code>node_modules</code> 在任何根目录中找不到任何文件夹时，加载程序将使用默认缓存目录或回退到默认的OS临时文件目录。实际使用中，效果显著；配置示例如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rules: [</span><br><span class="line">  &#123;</span><br><span class="line">    test: /\.js$/,</span><br><span class="line">    loader: &apos;babel-loader?cacheDirectory=true&apos;,</span><br><span class="line">    exclude: /node_modules/,</span><br><span class="line">    include: [resolve(&apos;src&apos;), resolve(&apos;test&apos;)]</span><br><span class="line">  &#125;,</span><br><span class="line">  ... ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="设置-noParse"><a href="#设置-noParse" class="headerlink" title="设置 noParse"></a>设置 <a href="https://webpack.github.io/docs/configuration.html#module-noparse" target="_blank" rel="noopener">noParse</a></h2><p>如果你确定一个模块中，没有其它新的依赖，就可以配置这项， <code>Webpack</code> 将不再扫描这个文件中的依赖，这对于比较大型类库，将能促进性能表现，具体可以参见以下配置：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">module: &#123;</span><br><span class="line">  noParse: /node_modules\/(element-ui\.js)/,</span><br><span class="line">  rules: [</span><br><span class="line">    &#123;</span><br><span class="line">      ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="拷贝静态文件"><a href="#拷贝静态文件" class="headerlink" title="拷贝静态文件"></a>拷贝静态文件</h2><p>在前文 <a href="https://ningyu1.github.io/site/post/26-webpack1/">Webpack 打包优化之体积</a>篇中提到，引入 <code>DllPlugin</code> 和 <code>DllReferencePlugin</code> 来提前构建一些第三方库，来优化 <code>Webpack</code> 打包。而在生产环境时，就需要将提前构建好的包，同步到 <code>dist</code> 中；这里拷贝静态文件，你可以使用 <code>copy-webpack-plugin</code> 插件：把指定文件夹下的文件复制到指定的目录；其配置如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var CopyWebpackPlugin = require(&apos;copy-webpack-plugin&apos;)</span><br><span class="line">plugins: [</span><br><span class="line">  ...</span><br><span class="line">  // copy custom static assets</span><br><span class="line">  new CopyWebpackPlugin([</span><br><span class="line">    &#123;</span><br><span class="line">      from: path.resolve(__dirname, &apos;../static&apos;),</span><br><span class="line">      to: config.build.assetsSubDirectory,</span><br><span class="line">      ignore: [&apos;.*&apos;]</span><br><span class="line">    &#125;</span><br><span class="line">  ])</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>当然，这种工作，实现的法子很多，比如可以借助 <code>shelljs</code>，可以参见这里的实现 <a href="https://github.com/nicejade/vue-boilerplate-template/blob/master/build/build.js#L17-L22" target="_blank" rel="noopener">vue-boilerplate-template</a>。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-23T01:48:15.032Z" itemprop="dateUpdated">2024-04-23 09:48:15</time>
</span><br>


        
        原始链接：<a href="/20170920/27-webpack2.html" target="_blank" rel="external">https://ningyu1.github.io/20170920/27-webpack2.html</a><br>版权声明：本文由 <strong>凝雨-Yun</strong> 原创，采用<strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a></strong>进行许可。 <br><strong>转载请注明作者及出处！</strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        
    </div>
    
    <footer>
        <a href="https://ningyu1.github.io">
            <img src="/img/avatar.jpg" alt="凝雨">
            凝雨
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/React/">React</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Vue/">Vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Webpack/">Webpack</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170920/27-webpack2.html&title=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170920/27-webpack2.html&title=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170920/27-webpack2.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170920/27-webpack2.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170920/27-webpack2.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/20170925/28-redis-client-sentinel.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">RedisClient升级支持Sentinel使用说明</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/20170920/26-webpack1.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Webpack 打包优化之体积篇</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '298f0d78bd14c9c0ff01',
          clientSecret: 'e81e4d36caf1a13d2f05ed5dcf30e636dde749ac',
          repo: 'blog',
          owner: 'ningyu1',
          admin: ['ningyu1'],
          id: id,      // Ensure uniqueness and length less than 50
	  //id: 'Comments',
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        可以吃个鸡腿吗？
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.zh">知识共享署名-相同方式共享 4.0 国际许可协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>凝雨 &copy; 2016 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170920/27-webpack2.html&title=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170920/27-webpack2.html&title=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170920/27-webpack2.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Webpack 打包优化之速度篇》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170920/27-webpack2.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170920/27-webpack2.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3aS44CMQwFQO5/aWaLhGienTBSO9WrEWg6qY3x7/GIn+fLc/3J+7evn7+/8/qUzQ8GBsZtGc/LJ7lW8m1CTc79SMXAwDiAcR0Qe4E1Oj4+68udMTAwMIJ0LU8fewEaAwMDYyXgJu9JCtTrwhgDAwMjKSZ7V6822n5ei2NgYNyQkXfd///vn8w3MDAwbsV4Fp887Vu5VvlWGBgYoxm9Vlq+ZrG+HZGXuxgYGFMZveWtvFW3EmrzO2BgYMxm7Do4L33zVK8Z1jEwMMYxegPF3oJXfrnqeBUDA2M2I//n9eXU3nJYPuzEwMA4gbFrrWE94FZDPAYGBkZvuFgddpbD66c8FwMD4wBGnthVU8ByUXoZvr+khhgYGIMYvbZXb9DYK2LLVTgGBsY4Ru+Y5OD1NtzSsgUGBsY4xvV1q4OBXvusOpyIBgMYGBjjGL3FrxVkNT3dsDmCgYFxQ0Z10aH6rIwk84QSAwNjNiM/LG/x94JyrzzGwMA4jdFrwFXXL6qJYJ5KYmBgnMCovihfqsgXv3oDBgwMjDMZvSOrY8heovllcwQDA2McY1d6l48B8u2IQtmMgYExmrHS4q8GzfVAHDXdMDAwhjJ2BdneADJZ1CjPYzEwMIYyksFAdXjQa88t1eIYGBgYy8249ZWywjYHBgbGwYzqOCFJKPMx5+bfDQwMjFsxqsfsKner1A21OAYGxg0ZeaK2a8EiCc3VUQEGBsZQxh9P1foIuCGZ1AAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-indigo-patch@1.0.0/source/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
