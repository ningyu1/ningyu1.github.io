<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113235655-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?83434579b8f6b6a6c80fd1b4fe2d9afa"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="tyyr-WLO-Sq85TjMOOOHRRc5YD4W8if8mCXbUD_p_7k">
    
    
    <meta name="sogou_site_verification" content="PlW7T4UKFR">
    
    
    <meta name="baidu-site-verification" content="AdjyK6UssW">
    
    
    <meta name="msvalidate.01" content="BC20DDADC069448DFBCA67D9D7D57546">
    
    
    <meta name="360-site-verification" content="3addb98f1fb5f6b4d1ce03efc23bf5b8">
    
    
    
    <title>ActiveMQ使用经验分享，配置详解 | 凝雨 - Yun | 快乐编程每一天 - Happy Coding Every Day</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="MQ,ActiveMQ">
    <meta name="description" content="ActiveMQ使用经验分享，配置详解">
<meta name="keywords" content="MQ,ActiveMQ">
<meta property="og:type" content="article">
<meta property="og:title" content="ActiveMQ使用经验分享，配置详解">
<meta property="og:url" content="https://ningyu1.github.io/20170511/06-activemq-settings.html">
<meta property="og:site_name" content="凝雨 - Yun">
<meta property="og:description" content="ActiveMQ使用经验分享，配置详解">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ningyu1.github.io/img/activemq/1.jpg">
<meta property="og:image" content="https://ningyu1.github.io/img/activemq/2.jpg">
<meta property="og:image" content="https://ningyu1.github.io/img/activemq/3.jpg">
<meta property="og:updated_time" content="2024-04-23T01:48:15.029Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ActiveMQ使用经验分享，配置详解">
<meta name="twitter:description" content="ActiveMQ使用经验分享，配置详解">
<meta name="twitter:image" content="https://ningyu1.github.io/img/activemq/1.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="凝雨 - Yun" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">凝雨</h5>
          <a href="mailto:ningbe111@163.com" title="ningbe111@163.com" class="mail">ningbe111@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives/"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ningyu1" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                Rss
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://g2.okk.dog/?path=register&code=qn7nOwdj" target="_blank" >
                <i class="icon icon-lg icon-rocket"></i>
                科学上网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">ActiveMQ使用经验分享，配置详解</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">ActiveMQ使用经验分享，配置详解</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-05-11T04:03:10.000Z" itemprop="datePublished" class="page-time">
  2017-05-11
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ActiveMQ/">ActiveMQ</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>文章目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#mq-properties"><span class="post-toc-number">1.</span> <span class="post-toc-text">mq.properties</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#spring-mq-xml"><span class="post-toc-number">2.</span> <span class="post-toc-text">spring-mq.xml</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置说明"><span class="post-toc-number">3.</span> <span class="post-toc-text">配置说明</span></a></li></ol>
        </nav>
    </aside>


<article id="post-06-activemq-settings"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">ActiveMQ使用经验分享，配置详解</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-05-11 12:03:10" datetime="2017-05-11T04:03:10.000Z"  itemprop="datePublished">2017-05-11</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/ActiveMQ/">ActiveMQ</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>根据我们的使用场景抽取出来了一系列activemq公共配置参数mq.properties</p>
<h2 id="mq-properties"><a href="#mq-properties" class="headerlink" title="mq.properties"></a>mq.properties</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">activemq.connnect.brokerurl=failover:(tcp://192.168.0.66:61616)</span><br><span class="line">activemq.connnect.useAsyncSend=true</span><br><span class="line"># object对象接受报名单,true不受限制,false需要设置白名单</span><br><span class="line">activemq.connnect.trustAllPackages=true</span><br><span class="line"> </span><br><span class="line"># 最大连接数</span><br><span class="line">activemq.pool.maxConnections=20</span><br><span class="line"># 空闲失效时间,毫秒</span><br><span class="line">activemq.pool.idleTimeout=60000</span><br><span class="line"> </span><br><span class="line"># 初始数量</span><br><span class="line">activemq.listener.pool.corePoolSize=5</span><br><span class="line">activemq.listener.pool.maxPoolSize=10</span><br><span class="line"># 启动守护进程</span><br><span class="line">activemq.listener.pool.daemon=true</span><br><span class="line"># 单位秒</span><br><span class="line">activemq.listener.pool.keepAliveSeconds=120</span><br><span class="line"></span><br><span class="line"># 由于jms:listener-container不支持propertyPlaceholder替换，因此这些参数值写在spring-mq.xml文件中，参考值</span><br><span class="line"># </span><br><span class="line"># 接收消息时的超时时间,单位毫秒</span><br><span class="line">activemq.consumer.receiveTimeout=60000</span><br><span class="line"># 监听目标类型</span><br><span class="line">activemq.listener.destinationtype=queue</span><br><span class="line"># 监听确认消息方式</span><br><span class="line">activemq.listener.acknowledge=auto</span><br><span class="line"># 监听数量</span><br><span class="line">activemq.listener.concurrency=2-10</span><br></pre></td></tr></table></figure>
<h2 id="spring-mq-xml"><a href="#spring-mq-xml" class="headerlink" title="spring-mq.xml"></a>spring-mq.xml</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:amq=&quot;http://activemq.apache.org/schema/core&quot;</span><br><span class="line">    xmlns:jms=&quot;http://www.springframework.org/schema/jms&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans   </span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans-4.0.xsd   </span><br><span class="line">        http://www.springframework.org/schema/context   </span><br><span class="line">        http://www.springframework.org/schema/context/spring-context-4.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/jms</span><br><span class="line">        http://www.springframework.org/schema/jms/spring-jms-4.0.xsd</span><br><span class="line">        http://activemq.apache.org/schema/core</span><br><span class="line">        http://activemq.apache.org/schema/core/activemq-core-5.8.0.xsd&quot;&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 配置activeMQ连接 tcp://192.168.0.66:61616 --&gt;</span><br><span class="line">    &lt;bean id=&quot;targetConnectionFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;brokerURL&quot; value=&quot;$&#123;activemq.connnect.brokerurl&#125;&quot; /&gt;</span><br><span class="line">        &lt;!-- useAsyncSend 异步发送 --&gt;</span><br><span class="line">        &lt;property name=&quot;useAsyncSend&quot; value=&quot;$&#123;activemq.connnect.useAsyncSend&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">        &lt;!-- 关闭对象传输有白名单限制 --&gt;</span><br><span class="line">        &lt;property name=&quot;trustAllPackages&quot; value=&quot;$&#123;activemq.connnect.trustAllPackages&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 通过往PooledConnectionFactory注入一个ActiveMQConnectionFactory可以用来将Connection，Session和MessageProducer池化 </span><br><span class="line">        这样可以大大减少我们的资源消耗， --&gt;</span><br><span class="line">    &lt;bean id=&quot;pooledConnectionFactory&quot; class=&quot;org.apache.activemq.pool.PooledConnectionFactory&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;connectionFactory&quot; ref=&quot;targetConnectionFactory&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;maxConnections&quot; value=&quot;$&#123;activemq.pool.maxConnections&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;idleTimeout&quot; value=&quot;$&#123;activemq.pool.idleTimeout&#125;&quot; /&gt;</span><br><span class="line">        &lt;!-- maximumActiveSessionPerConnection : 500  每个连接中使用的最大活动会话数 --&gt;</span><br><span class="line">        &lt;!-- idleTimeout : 30 * 1000 单位毫秒 --&gt;</span><br><span class="line">        &lt;!-- blockIfSessionPoolIsFull : true --&gt;</span><br><span class="line">        &lt;!-- blockIfSessionPoolIsFullTimeout : -1L --&gt;</span><br><span class="line">        &lt;!-- expiryTimeout : 0L --&gt;</span><br><span class="line">        &lt;!-- createConnectionOnStartup : true --&gt;</span><br><span class="line">        &lt;!-- useAnonymousProducers : true --&gt;</span><br><span class="line">        &lt;!-- reconnectOnException : true --&gt;</span><br><span class="line">        &lt;!-- maxConnections : 默认1 --&gt;</span><br><span class="line">        &lt;!-- timeBetweenExpirationCheckMillis : -1 --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 线程池配置 --&gt;</span><br><span class="line">    &lt;bean id=&quot;queueMessagee x e cutor&quot;</span><br><span class="line">        class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaske x e cutor&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;corePoolSize&quot; value=&quot;$&#123;activemq.listener.pool.corePoolSize&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;maxPoolSize&quot; value=&quot;$&#123;activemq.listener.pool.maxPoolSize&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;daemon&quot; value=&quot;$&#123;activemq.listener.pool.daemon&#125;&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;keepAliveSeconds&quot; value=&quot;$&#123;activemq.listener.pool.keepAliveSeconds&#125;&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 定义JmsTemplate的Queue类型 --&gt;</span><br><span class="line">    &lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;</span><br><span class="line">        &lt;constructor-arg ref=&quot;pooledConnectionFactory&quot; /&gt;</span><br><span class="line">        &lt;!-- deliveryMode : PERSISTENT 默认保存消息 --&gt;</span><br><span class="line">        &lt;!-- messageIdEnabled : true 默认有消息id --&gt;</span><br><span class="line">        &lt;!-- messageTimestampEnabled : true 默认有消息发送时间 --&gt;</span><br><span class="line">        &lt;!-- pubSubNoLocal : false,默认点对点(Queues) --&gt;</span><br><span class="line">        &lt;!-- receiveTimeout : 0 阻塞接收不超时,接收消息时的超时时间,单位毫秒  --&gt;</span><br><span class="line">        &lt;!-- deliveryDelay : 0  --&gt;</span><br><span class="line">        &lt;!-- explicitQosEnabled : false  --&gt;</span><br><span class="line">        &lt;!-- priority : 4  --&gt;</span><br><span class="line">        &lt;!-- timeToLive : 0  --&gt;</span><br><span class="line">        &lt;!-- pubSubDomain : false  --&gt;</span><br><span class="line">        &lt;!-- defaultDestination : 默认目标，默认null  --&gt;</span><br><span class="line">        &lt;!-- messageConverter : 消息转换器，默认SimpleMessageConverter  --&gt;</span><br><span class="line">        &lt;!-- sessionTransacted : 事务控制，默认false  --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;!-- 定义Queue监听器 --&gt;</span><br><span class="line">    &lt;!-- 由于jms:listener-container不支持propertyPlaceholder替换，因此这些参数值写在spring-mq.xml文件中，参考值：mq.properties文件中 --&gt;</span><br><span class="line">    &lt;jms:listener-container task-e x e cutor=&quot;queueMessagee x e cutor&quot; receive-timeout=&quot;60000&quot;</span><br><span class="line">        destination-type=&quot;queue&quot; container-type=&quot;default&quot; connection-factory=&quot;pooledConnectionFactory&quot;</span><br><span class="line">        acknowledge=&quot;auto&quot; concurrency=&quot;2-10&quot; &gt;</span><br><span class="line">        &lt;jms:listener destination=&quot;QUEUE.EMAIL&quot; ref=&quot;mailMessageListener&quot; /&gt;</span><br><span class="line">        &lt;jms:listener destination=&quot;QUEUE.SMS&quot; ref=&quot;smsMessageListener&quot; /&gt;</span><br><span class="line">    &lt;/jms:listener-container&gt;</span><br><span class="line"> </span><br><span class="line">    &lt;bean id=&quot;smsMessageListener&quot;</span><br><span class="line">        class=&quot;org.springframework.jms.listener.adapter.MessageListenerAdapter&quot;&gt;</span><br><span class="line">        &lt;!-- 默认调用方法handleMessage --&gt;</span><br><span class="line">        &lt;property name=&quot;delegate&quot;&gt;</span><br><span class="line">            &lt;bean class=&quot;com.domain.framework.message.sms.listener.SMSMessageListener&quot; /&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;defaultListenerMethod&quot; value=&quot;receiveMessage&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">     </span><br><span class="line">    &lt;bean id=&quot;mailMessageListener&quot;</span><br><span class="line">        class=&quot;org.springframework.jms.listener.adapter.MessageListenerAdapter&quot;&gt;</span><br><span class="line">        &lt;!-- 默认调用方法handleMessage --&gt;</span><br><span class="line">        &lt;property name=&quot;delegate&quot;&gt;</span><br><span class="line">            &lt;bean class=&quot;com.domain.framework.message.mail.listener.EmailMessageListener&quot; /&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property name=&quot;defaultListenerMethod&quot; value=&quot;receiveMessage&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"> </span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<h2 id="配置说明"><a href="#配置说明" class="headerlink" title="配置说明"></a>配置说明</h2><ol>
<li>trustAllPackages<ol>
<li>等于false时，在做object序列化时会有Class Not Found Exception：This class is not trusted to be serialized as ObjectMessage payload异常抛出，是因为activemq服务器默认是不接受object序列化对象，需要配置白名单（接受的object对象class全名）</li>
<li>等于true时关闭验证</li>
<li>传输对象安全说明: <a href="http://activemq.apache.org/objectmessage.htm" title="http://activemq.apache.org/objectmessage.htm" target="_blank" rel="noopener">http://activemq.apache.org/objectmessage.htm</a></li>
</ol>
</li>
<li>useAsyncSend<ol>
<li>开启异步消息发送，主要是一个性能上的提升从而提升消息吞吐量，但是不能拿到消息发送后的回执消息，消息不会丢失</li>
<li>异步发送的说明：<a href="http://activemq.apache.org/async-sends.html" title="http://activemq.apache.org/async-sends.html" target="_blank" rel="noopener">http://activemq.apache.org/async-sends.html</a></li>
</ol>
</li>
<li><p>executor corePoolSize</p>
<ol>
<li><p>该值的配置需要结合listener的个数和concurrency的数量去灵活配置</p>
<p>案例分析</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id=&quot;queueMessageExecutor&quot;</span><br><span class="line">    class=&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;corePoolSize&quot; value=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;maxPoolSize&quot; value=&quot;10&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;daemon&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;keepAliveSeconds&quot; value=&quot;120&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;jms:listener-container task-executor=&quot;queueMessageExecutor&quot; receive-timeout=&quot;60000&quot;</span><br><span class="line">    destination-type=&quot;queue&quot; container-type=&quot;default&quot; connection-factory=&quot;pooledConnectionFactory&quot;</span><br><span class="line">    acknowledge=&quot;auto&quot; concurrency=&quot;2-10&quot; &gt;</span><br><span class="line">    &lt;jms:listener destination=&quot;QUEUE.EMAIL&quot; ref=&quot;mailMessageListener&quot; /&gt;</span><br><span class="line">    &lt;jms:listener destination=&quot;QUEUE.SMS&quot; ref=&quot;smsMessageListener&quot; /&gt;</span><br><span class="line">&lt;/jms:listener-container&gt;</span><br></pre></td></tr></table></figure>
<p>项目中有2个listener并且项目希望启动初始每个listener启动2个consumer最大10个consumer，如果e x e cutor corePoolSize配置为2，那么启动后只会给一个listener分配2个consumer，因为e x e cutor pool的初始配置数量不够，见下图</p>
<p><img src="/img/activemq/1.jpg" alt="activemq1"><br>修改corePoolSize之后</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;property name=&quot;corePoolSize&quot; value=&quot;5&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p><img src="/img/activemq/2.jpg" alt="activemq2"></p>
</li>
</ol>
</li>
<li>executor daemon<ol>
<li>是否创建守护线程</li>
<li>设置为true时，在应用程序在紧急关闭时，任然会执行没有完成的runtime线程 </li>
</ol>
</li>
<li>jms:listener-container<ol>
<li>由于不支持propertyPlaceholder替换，因此这些参数值写在spring-mq.xml文件中，参考值：mq.properties文件中</li>
<li>destination-type 目标类型（QUEUE, TOPIC, DURABLETOPIC）</li>
<li>acknowledge 消息确认方式（auto、client、dups-ok、transacted）</li>
<li>concurrency listener consumer个数</li>
</ol>
</li>
<li>message-converter <ol>
<li>消息转换器，我们这里不配置特殊的转换器，使用Spring提供的org.springframework.jms.support.converter.SimpleMessageConverter.SimpleMessageConverter()简单转换器，支持对象（String、byte[]、Map、Serializable）</li>
<li>结合org.springframework.jms.listener.adapter.MessageListenerAdapter做接受消息自动转换对象</li>
<li>结合org.springframework.jms.core.JmsTemplate使用convertAndSend系列方法对象转换并发送，实现发送消息自动转换。</li>
<li>我们为什么不使用json做消息转换，因为json转换在反序列话时需要明确序列化Class类型，丢失了消息转换器的通用性。</li>
</ol>
</li>
<li>Listener<ol>
<li>支持实现JMS接口的类javax.jms.MessageListener，它是一个来自JMS规范的标准化接口，但是你要处理线程。。</li>
<li>支持Spring SessionAwareMessageListener，这是一个Spring特定的接口，提供对JMS会话对象的访问。 这对于请求 - 响应消息传递非常有用。 只需要注意，你必须做自己的异常处理（即，重写handleListenerException方法，这样异常不会丢失）。</li>
<li>支持Spring MessageListenerAdapter，这是一个Spring特定接口，允许特定类型的消息处理。 使用此接口可避免代码中任何特定于JMS的依赖关系。</li>
</ol>
</li>
<li><p>MessageListenerAdapter</p>
<ol>
<li><p>可以代理任意POJO类，无需实现JMS接口，任意指定回调方法，并且消息转换内置实现，JMS会话默认封装<br>使用示例：<br>消息接收</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id=&quot;mailMessageListener&quot;</span><br><span class="line">    class=&quot;org.springframework.jms.listener.adapter.MessageListenerAdapter&quot;&gt;</span><br><span class="line">    &lt;!-- 默认调用方法handleMessage --&gt;</span><br><span class="line">    &lt;property name=&quot;delegate&quot;&gt;</span><br><span class="line">        &lt;bean class=&quot;com.domain.framework.message.mail.listener.EmailMessageListener&quot; /&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;defaultListenerMethod&quot; value=&quot;receiveMessage&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">public class EmailMessageListener &#123;</span><br><span class="line">    public void receiveMessage(EmailMessageVo message) &#123;</span><br><span class="line">        ...someing....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>消息发送</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id=&quot;jmsTemplate&quot; class=&quot;org.springframework.jms.core.JmsTemplate&quot;&gt;</span><br><span class="line">    &lt;constructor-arg ref=&quot;pooledConnectionFactory&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">@Component(&quot;emailService&quot;)</span><br><span class="line">public class EmailServiceImpl implements IEmailService &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private JmsTemplate jmsTemplate;</span><br><span class="line">     </span><br><span class="line">    @Override</span><br><span class="line">    public void sendEmailMessage(EmailMessageVo message) throws BizException &#123;</span><br><span class="line">        if(message != null) &#123;</span><br><span class="line">            jmsTemplate.convertAndSend(QueueNames.EMAIL, message);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            logger.warn(&quot;sendEmailMessage() param[message] is null ,can&apos;t send message!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ps.上面的示例主要是org.springframework.jms.core.JmsTemplate与org.springframework.jms.listener.adapter.MessageListenerAdapter和业务的POJO做消费者的一个结合使用示例，无需关注序列化，发送与接受对象直接使用业务POJO</strong></p>
</li>
</ol>
</li>
<li>Q名称的命名规则<ol>
<li>名称我们采用大写字母，多个单词之间分隔符使用“.”,例如：QUEUE.XXX、TOPIC.XXX</li>
<li>根据产品线或项目名称增加namespace，例如：APP1.QUEUE.XXX、APP2.QUEUE.XXX</li>
</ol>
</li>
<li><p>Active MQ包使用说明</p>
<ol>
<li>不要使用activemq-all这个包，这个包打包了依赖（pool源码，spring源码，log4j源码，jms源码），会跟我们的日志框架产生冲突</li>
<li>我们使用activemq-pool、activemq-client、activemq-broker、spring-jms去替换上面的activemq-all包</li>
</ol>
<p><img src="/img/activemq/3.jpg" alt="activemq3"></p>
</li>
</ol>
<p><strong>Spring+Activemq使用配置非常灵活，我们不拘泥于一种形式，如果有更好的经验尽管提出来我们共同努力和进步。</strong></p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-23T01:48:15.029Z" itemprop="dateUpdated">2024-04-23 09:48:15</time>
</span><br>


        
        原始链接：<a href="/20170511/06-activemq-settings.html" target="_blank" rel="external">https://ningyu1.github.io/20170511/06-activemq-settings.html</a><br>版权声明：本文由 <strong>凝雨-Yun</strong> 原创，采用<strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a></strong>进行许可。 <br><strong>转载请注明作者及出处！</strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        
    </div>
    
    <footer>
        <a href="https://ningyu1.github.io">
            <img src="/img/avatar.jpg" alt="凝雨">
            凝雨
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ActiveMQ/">ActiveMQ</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MQ/">MQ</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170511/06-activemq-settings.html&title=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170511/06-activemq-settings.html&title=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170511/06-activemq-settings.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170511/06-activemq-settings.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170511/06-activemq-settings.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/20170602/05-cache-design.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Cache设计和使用上的套路</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/20170510/07-maven-settings.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Maven settings.xml详解</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '298f0d78bd14c9c0ff01',
          clientSecret: 'e81e4d36caf1a13d2f05ed5dcf30e636dde749ac',
          repo: 'blog',
          owner: 'ningyu1',
          admin: ['ningyu1'],
          id: id,      // Ensure uniqueness and length less than 50
	  //id: 'Comments',
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        可以吃个鸡腿吗？
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.zh">知识共享署名-相同方式共享 4.0 国际许可协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>凝雨 &copy; 2016 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170511/06-activemq-settings.html&title=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170511/06-activemq-settings.html&title=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170511/06-activemq-settings.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《ActiveMQ使用经验分享，配置详解》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170511/06-activemq-settings.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170511/06-activemq-settings.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACMklEQVR42u3a0Y4iMQwEQP7/p9nXk24Zuh043SSVJ7SESYqVjO3k8YjH84/x99/z+defTT61NDAwMG7LeF6OVwu0i11vMVn31RwMDIxzGNcBMXn09cyVtZJgjYGBgZFs7jpxjIImBgYGxocYefLXFqWzAI2BgXEOI0/4VsLif1GLY2Bg3JCRh8J///or5xsYGBi3YjzLMTt6zMvd2cDAwNib8Y0CNU/dVtI+DAyM0xhJGG2vX8wKzvby2SOvmzEwMG7OyK9NtGlfApulpC9/NzAwMLZjJAExb4S1pems3P1lPgYGxtaM9rgxb5Ylrf9rWHvYiYGBsTej3VzejMu3lTT13pSyGBgYWzOKtvsoZcyL2HYnw/8PBgbGbRnfu3e2XgYXJS4GBsamjFni1SaCxQWv+An1rwQGBsbNGUlhOTtizNO+D1y2wMDA2I4xa83nCV97tDCcg4GBcRhjBbNyzWJWJGNgYJzAyFO6JClsDzLbd9/MwcDA2JrRlqDrYTpv0hUnGxgYGFszZkvmiWMb0IcHEhgYGAcw2kSw7cwn785SVQwMjNMYs8VWgu+jHG9yWwwMjO0Yz3Lk9xzaVG/WvMPAwDiB0Ya5PEFst5uUqbOvCQMDYw9GEmTzwJcXpckT8i8FAwPjBEbegm/L3ZWrFQUSAwMDY3RFbKULWBexGBgYGHmKdvmETwXxDwRcDAyMGzLaMJo3y2ZFaV0MY2BgbM2YJXDroXOWFC4damJgYNyP8QMlgFWDffNjbQAAAABJRU5ErkJggg==" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-indigo-patch@1.0.0/source/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
