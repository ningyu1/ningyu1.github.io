<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113235655-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?83434579b8f6b6a6c80fd1b4fe2d9afa"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="tyyr-WLO-Sq85TjMOOOHRRc5YD4W8if8mCXbUD_p_7k">
    
    
    <meta name="sogou_site_verification" content="PlW7T4UKFR">
    
    
    <meta name="baidu-site-verification" content="AdjyK6UssW">
    
    
    <meta name="msvalidate.01" content="BC20DDADC069448DFBCA67D9D7D57546">
    
    
    <meta name="360-site-verification" content="3addb98f1fb5f6b4d1ce03efc23bf5b8">
    
    
    
    <title>Nginx 502 Bad Gateway问题分析与踩过的坑 | 凝雨 - Yun | 快乐编程每一天 - Happy Coding Every Day</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="Nginx,Bad Gateway,调优">
    <meta name="description" content="Nginx 502 Bad Gateway问题分析与踩过的坑">
<meta name="keywords" content="Nginx,Bad Gateway,调优">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx 502 Bad Gateway问题分析与踩过的坑">
<meta property="og:url" content="https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html">
<meta property="og:site_name" content="凝雨 - Yun">
<meta property="og:description" content="Nginx 502 Bad Gateway问题分析与踩过的坑">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://ningyu1.github.io/img/nginx/2.jpg">
<meta property="og:image" content="https://ningyu1.github.io/img/nginx/3.jpg">
<meta property="og:image" content="https://ningyu1.github.io/img/nginx/1.jpg">
<meta property="og:image" content="https://ningyu1.github.io/img/nginx/4.jpg">
<meta property="og:updated_time" content="2024-04-23T01:48:15.029Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx 502 Bad Gateway问题分析与踩过的坑">
<meta name="twitter:description" content="Nginx 502 Bad Gateway问题分析与踩过的坑">
<meta name="twitter:image" content="https://ningyu1.github.io/img/nginx/2.jpg">
    
        <link rel="alternate" type="application/atom+xml" title="凝雨 - Yun" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">凝雨</h5>
          <a href="mailto:ningbe111@163.com" title="ningbe111@163.com" class="mail">ningbe111@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives/"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ningyu1" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                Rss
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://g2.okk.dog/?path=register&code=qn7nOwdj" target="_blank" >
                <i class="icon icon-lg icon-rocket"></i>
                科学上网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Nginx 502 Bad Gateway问题分析与踩过的坑</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Nginx 502 Bad Gateway问题分析与踩过的坑</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-06-30T10:36:44.000Z" itemprop="datePublished" class="page-time">
  2017-06-30
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/">Nginx</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/Case-analysis/">Case analysis</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/Case-analysis/trouble-shooting/">trouble shooting</a></li></ul></li></ul></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>文章目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#我相信使用Nginx的都会遇到过502-504-这种bad-gateway错误，下面我把碰到这个问题分析过程记录并分享出来。"><span class="post-toc-number">1.</span> <span class="post-toc-text">我相信使用Nginx的都会遇到过502 504 这种bad gateway错误，下面我把碰到这个问题分析过程记录并分享出来。</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置"><span class="post-toc-number">2.</span> <span class="post-toc-text">1. 第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2-于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息"><span class="post-toc-number">3.</span> <span class="post-toc-text">2. 于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-在nginx的log中发现了请求都是使用的HTTP-1-0，大家应该知道HTTP-1-0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1-0呢？"><span class="post-toc-number">4.</span> <span class="post-toc-text">3. 在nginx的log中发现了请求都是使用的HTTP 1.0，大家应该知道HTTP 1.0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1.0呢？</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构"><span class="post-toc-number">5.</span> <span class="post-toc-text">跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#测试通过"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">测试通过</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-03-nginx-502-Bad-Gateway"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Nginx 502 Bad Gateway问题分析与踩过的坑</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-06-30 18:36:44" datetime="2017-06-30T10:36:44.000Z"  itemprop="datePublished">2017-06-30</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/">Nginx</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/Case-analysis/">Case analysis</a><ul class="article-category-list-child"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Nginx/Case-analysis/trouble-shooting/">trouble shooting</a></li></ul></li></ul></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h3 id="我相信使用Nginx的都会遇到过502-504-这种bad-gateway错误，下面我把碰到这个问题分析过程记录并分享出来。"><a href="#我相信使用Nginx的都会遇到过502-504-这种bad-gateway错误，下面我把碰到这个问题分析过程记录并分享出来。" class="headerlink" title="我相信使用Nginx的都会遇到过502 504 这种bad gateway错误，下面我把碰到这个问题分析过程记录并分享出来。"></a>我相信使用Nginx的都会遇到过502 504 这种bad gateway错误，下面我把碰到这个问题分析过程记录并分享出来。</h3><p>先让我们看一下具体的错误信息<br><figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="number">502</span> <span class="symbol">Bad</span> <span class="symbol">Gateway</span></span><br><span class="line"><span class="symbol">The</span> proxy server received an invalid response from an upstream server</span><br></pre></td></tr></table></figure></p>
<p>从字面上的意思理解，nginx从upstream没有接受到信息，第一感觉就是连接被close？还是超时了？超时的话一般错误信息是 timeout</p>
<p>下面是尝试解决这个问题尝试过的手段</p>
<h3 id="1-第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置"><a href="#1-第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置" class="headerlink" title="1. 第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置"></a>1. 第一感觉是proxy返回超时，因此查找nginx官方文档，找到关于proxy的timeout设置</h3><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	proxy_connect_timeout time;</span><br><span class="line">Default:	</span><br><span class="line"><span class="attribute">proxy_connect_timeout</span> <span class="number">60s</span>;</span><br><span class="line">Context:	http, server, location</span><br><span class="line"><span class="attribute">Defines</span> a timeout for establishing a connection with a proxied server. It should be noted that this timeout cannot usually exceed <span class="number">75</span> seconds.</span><br></pre></td></tr></table></figure>
<p>ps. 这个时间不能超过75秒<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	proxy_read_timeout time;</span><br><span class="line">Default:	</span><br><span class="line"><span class="attribute">proxy_read_timeout</span> <span class="number">60s</span>;</span><br><span class="line">Context:	http, server, location</span><br><span class="line"><span class="attribute">Defines</span> a timeout for reading a response from the proxied server. The timeout is set only between two successive read operations, not for the transmission of the whole response. If the proxied server does not transmit anything within this time, the connection is closed.</span><br></pre></td></tr></table></figure></p>
<p>ps. 两次read的超时时间，并不是整个的response的超时时间<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	proxy_send_timeout time;</span><br><span class="line">Default:	</span><br><span class="line"><span class="attribute">proxy_send_timeout</span> <span class="number">60s</span>;</span><br><span class="line">Context:	http, server, location</span><br><span class="line"><span class="attribute">Sets</span> a timeout for transmitting a request to the proxied server. The timeout is set only between two successive write operations, not for the transmission of the whole request. If the proxied server does not receive anything within this time, the connection is closed.</span><br></pre></td></tr></table></figure></p>
<p>ps. 两次write的超时时间，并不是整个request的超时时间</p>
<p>配置后重启nginx服务进行测试仍然有502错误爆出，继续分析</p>
<h3 id="2-于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息"><a href="#2-于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息" class="headerlink" title="2. 于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息"></a>2. 于是想到了keepalive，分析我们的请求报文头，报文是有keep-alive的头信息</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/nginx/2.jpg" alt="site Architecture" title>
                </div>
                <div class="image-caption">site Architecture</div>
            </figure>
<p>那问题出在哪里？我们应该知道前端请求如果设置为长连接必须要服务端也支持长连接才行，难道是服务器上没有配置长连接导致的？</p>
<p>翻nginx官网找keepalive的相关配置<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	keepalive_timeout timeout [header_timeout];</span><br><span class="line">Default:	</span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">75s</span>;</span><br><span class="line">Context:	http, server, location</span><br><span class="line"><span class="attribute">The</span> first parameter sets a timeout during which a keep-alive client connection will stay open <span class="literal">on</span> the server side. The zero value disables keep-alive client connections. The optional second parameter sets a value in the “Keep-Alive: timeout=time” response header field. Two parameters may differ.</span><br><span class="line"></span><br><span class="line">The “Keep-Alive: timeout=time” header field is recognized by Mozilla and Konqueror. MSIE closes keep-alive connections by itself in about <span class="number">60</span> seconds.</span><br></pre></td></tr></table></figure></p>
<p>ps.长连接保持的超时时间设置<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	keepalive connections;</span><br><span class="line">Default:	—</span><br><span class="line">Context:	upstream</span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">1</span>.<span class="number">4</span>.</span><br><span class="line">Activates the cache for connections to upstream servers.</span><br><span class="line"></span><br><span class="line">The connections parameter sets the maximum number of idle keepalive connections to upstream servers that are preserved in the cache of each worker process. When this number is exceeded, the least recently used connections are closed.</span><br></pre></td></tr></table></figure></p>
<p>ps. 设置upstream长连接的数量</p>
<p>查看tomcat的keepalive的设置</p>
<p>keepAliveTimeout：表示在下次请求过来之前，tomcat保持该连接多久。这就是说假如客户端不断有请求过来，且为超过过期时间，则该连接将一直保持。</p>
<p>maxKeepAliveRequests：表示该连接最大支持的请求数。超过该请求数的连接也将被关闭（此时就会返回一个Connection: close头给客户端）。</p>
<p>以上设置调整后重启服务进行测试，仍然有502错误爆出，继续分析</p>
<h3 id="3-在nginx的log中发现了请求都是使用的HTTP-1-0，大家应该知道HTTP-1-0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1-0呢？"><a href="#3-在nginx的log中发现了请求都是使用的HTTP-1-0，大家应该知道HTTP-1-0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1-0呢？" class="headerlink" title="3. 在nginx的log中发现了请求都是使用的HTTP 1.0，大家应该知道HTTP 1.0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1.0呢？"></a>3. 在nginx的log中发现了请求都是使用的HTTP 1.0，大家应该知道HTTP 1.0是不支持长连接的，于是顺着这条线继续查下去，为什么请求进来都是HTTP1.0呢？</h3><p>查看nginx官网的文档，发现proxy是可以只定HTTP版本的<br><figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line">Syntax:	proxy_http_version 1.0 | 1.1;</span><br><span class="line">Default:	</span><br><span class="line"><span class="attribute">proxy_http_version</span> <span class="number">1</span>.<span class="number">0</span>;</span><br><span class="line">Context:	http, server, location</span><br><span class="line"><span class="attribute">This</span> directive appeared in version <span class="number">1</span>.<span class="number">1</span>.<span class="number">4</span>.</span><br><span class="line">Sets the HTTP protocol version for proxying. By default, version <span class="number">1</span>.<span class="number">0</span> is used. Version <span class="number">1</span>.<span class="number">1</span> is recommended for use with keepalive connections and NTLM authentication.</span><br></pre></td></tr></table></figure></p>
<p>ps. 1.1.4以后的版本nginx默认使用的是HTTP1.0</p>
<p>于是我们查看一下nginx的版本 nginx -v，我们用的是nginx version: nginx/1.10.1，理论上默认开启的http1.1，不过没关系我们配置一下proxy_http_version 1.1试一下，这个参数要结合上面说道的upstream中的keepalive一起使用才能有效果。</p>
<p>修改好之后重启服务再次进行测试，依然有502的错误爆出，无解！！！，继续分析，为什么版本不生效呢？</p>
<p>我们前端请求的报文：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/nginx/3.jpg" alt="site Architecture" title>
                </div>
                <div class="image-caption">site Architecture</div>
            </figure>
<p>请求的明明是HTTP 1.1为什么到nginx中成了HTTP 1.0？</p>
<p>于是想到我们使用了阿里云的SLB，会不会是SLB的问题，先测试一下不通过SLB直接访问，查看日志<br><figure class="highlight prolog"><table><tr><td class="code"><pre><span class="line"><span class="number">100.97</span><span class="number">.90</span><span class="number">.213</span> - - [<span class="number">30</span>/<span class="symbol">Jun</span>/<span class="number">2017</span>:<span class="number">10</span>:<span class="number">44</span>:<span class="number">09</span> +<span class="number">0800</span>] <span class="string">"GET /api/v1/saleorder?dataSource=&amp;salesStatus=01&amp;shopNo=&amp;carrierAssignStatus=&amp;creTimeBegin=</span></span><br><span class="line"><span class="string">2017-06-30+00:00:00&amp;creTimeEnd=2017-06-30+23:59:59&amp;salesNo=&amp;status=&amp;carrierStatus=&amp;warehouseStatus=&amp;dataTranslateStatus=&amp;buyerAccount=&amp;changeBuyer=-1</span></span><br><span class="line"><span class="string">&amp;changeSeller=-1&amp;platformOrderTime=&amp;platformOrderEndTime=&amp;confirmPayTime=&amp;confirmPayEndTime=&amp;receiverMobile=&amp;receiverProvince=&amp;receiverCity=&amp;</span></span><br><span class="line"><span class="string">receiverArea=&amp;referenceNo=&amp;receiverName=&amp;page=1&amp;pageSize=50&amp;__preventCache=1498790641974 HTTP/1.1"</span> <span class="number">200</span> <span class="number">105705</span> <span class="string">"https://erp-uat.jiuyescm.com/"</span> </span><br><span class="line"><span class="string">"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/50.0.2661.102 Safari/537.36"</span></span><br></pre></td></tr></table></figure></p>
<p>日志果然出现了HTTP/1.1，这个让我们找到了希望，但是还有个区别，直接访问走的是ip+port普通的http，slb访问走的是域名而且是ssl，这个会不会跟ssl有关系，于是查询了ssl的http版本支持情况排除了这个问题，那就是继续往SLB上怀疑，翻阿里云负载均衡的说明文档。</p>
<p>让我找到了说明，查看如下信息</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/nginx/1.jpg" alt="site Architecture" title>
                </div>
                <div class="image-caption">site Architecture</div>
            </figure>
<p>找了半天原来是SLB强制转换了协议版本，具体查看阿里云负载均衡的<a href="https://help.aliyun.com/knowledge_detail/55201.html#httpversion" title="常见问题" target="_blank" rel="noopener">常见问题</a></p>
<p>问题没有解决，需要咨询阿里云工作人员看对于这类问题是否有好的解决方法，问题持续跟踪</p>
<h3 id="跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构"><a href="#跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构" class="headerlink" title="跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构"></a>跟阿里云客服沟通后，官方人员建议使用长连接通过slb的tcp协议，我们当初为了ssl方便配置slb选择的是http和https，因此就需要修改部署的结构</h3><ol>
<li>删除原有的slb</li>
<li>增加一个新的slb，协议选择tcp，添加两个端口监听，80-xxxx，443-xxxx</li>
<li>域名绑定的ip切换到新创建的slb</li>
<li>nginx中添加ssl-module，添加ssl证书配置，添加http跳转到https，调整80-xxxx，443-xxxx</li>
<li>重启nginx进行测试<h4 id="测试通过"><a href="#测试通过" class="headerlink" title="测试通过"></a>测试通过</h4><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="/img/nginx/4.jpg" alt="site Architecture" title>
                </div>
                <div class="image-caption">site Architecture</div>
            </figure>
</li>
</ol>
<p>采用这种部署方式来解决nginx 502问题</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-23T01:48:15.029Z" itemprop="dateUpdated">2024-04-23 09:48:15</time>
</span><br>


        
        原始链接：<a href="/20170630/03-nginx-502-Bad-Gateway.html" target="_blank" rel="external">https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html</a><br>版权声明：本文由 <strong>凝雨-Yun</strong> 原创，采用<strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a></strong>进行许可。 <br><strong>转载请注明作者及出处！</strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        
    </div>
    
    <footer>
        <a href="https://ningyu1.github.io">
            <img src="/img/avatar.jpg" alt="凝雨">
            凝雨
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Bad-Gateway/">Bad Gateway</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/调优/">调优</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&title=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&title=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/20170704/02-fastdfs-installer.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Fastdfs安装说明与常见问题解决</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/20170602/05-cache-design.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Cache设计和使用上的套路</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '298f0d78bd14c9c0ff01',
          clientSecret: 'e81e4d36caf1a13d2f05ed5dcf30e636dde749ac',
          repo: 'blog',
          owner: 'ningyu1',
          admin: ['ningyu1'],
          id: id,      // Ensure uniqueness and length less than 50
	  //id: 'Comments',
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        可以吃个鸡腿吗？
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.zh">知识共享署名-相同方式共享 4.0 国际许可协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>凝雨 &copy; 2016 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&title=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&title=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Nginx 502 Bad Gateway问题分析与踩过的坑》 — 凝雨 - Yun&url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20170630/03-nginx-502-Bad-Gateway.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtElEQVR42u3a204DMQwFwP7/T8NzVXV7bMe9SLNPCOgmE6TEnPh2i5+/h+fxp8mnkufZm5+NcuDBw8PDG0/9cbD8O9fLMZnu9fufLRAeHh7eHi953bNFSSZx/alkUZKlwcPDw/tOXo+d4JOqGA8PD+8XeXk8MV+4pDTHw8PD+xRv8rpku0++X410D2cteHh4eDGvF6F+9uuV+z08PDy88a16EqrmR8h14Vst36PZ4uHh4S3wqhPqNUXly5EEE+V54uHh4R3lTa75e4dEL8DNj4e7t+Hh4eEt86obfTUgmC9lM5/Gw8PDW+DlW39vu89HqRbWLxYIDw8Pb4E3DxQmke7kyr9wOOHh4eEd5eVFcx7CJuXyqbaqchiBh4eH9xZePnw1hpiHGs2bPTw8PLwB71TkWt24q+/ptTXg4eHhbfDyDTovl08dAJMw4q6kxsPDw1vjTRoF5o1Z+fFTuDbDw8PDW+b1mgDmv5+U2nnrwK33ATw8PLwi73rbzSPaXmtU1DgVBBAvUmo8PDy8Q7zetVYv0p1g8kI/+hvi4eHhDXjVJqfJ9dW8UaAcauDh4eEt8/KBewVxNa6tHhhRTxkeHh7emJfHCr3WgfIkWnFt1KqFh4eHd5SXT7FXKPcWKJ9blLXg4eHhLfCq5e/kmqpaplcvz/Dw8PDez+u1CEyur5KiuTkuHh4e3hovPwZOXYlVL96apTkeHh7eW3h5zJq3Z/Ui3cmRg4eHh7fB+ys+vUg3L8fLbVXXo+Ph4eEt8KobbjJkNXjNy/d8+ZrnCR4eHl7My5urJtOqNnX1DoYXnRF4eHh4R3n5dX61+an6nnm+goeHh/dtvPwIyYvyaotAobzGw8PD+xHevCGg9xR6yvDw8PDGvFOBbHU59gIRPDw8vD3e/B/+yQJNmgxOxRl4eHh4Me8fzO/aT1iL9FcAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-indigo-patch@1.0.0/source/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
