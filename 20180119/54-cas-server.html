<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
    
<!-- Google Analytics -->
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-113235655-1', 'auto');
ga('send', 'pageview');
</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<!-- End Google Analytics -->


    

    
<!-- Baidu Tongji -->
<script>var _hmt = _hmt || []</script>
<script async src="//hm.baidu.com/hm.js?83434579b8f6b6a6c80fd1b4fe2d9afa"></script>
<!-- End Baidu Tongji -->




    <meta charset="utf-8">
    
    <meta name="google-site-verification" content="tyyr-WLO-Sq85TjMOOOHRRc5YD4W8if8mCXbUD_p_7k">
    
    
    <meta name="sogou_site_verification" content="PlW7T4UKFR">
    
    
    <meta name="baidu-site-verification" content="AdjyK6UssW">
    
    
    <meta name="msvalidate.01" content="BC20DDADC069448DFBCA67D9D7D57546">
    
    
    <meta name="360-site-verification" content="3addb98f1fb5f6b4d1ce03efc23bf5b8">
    
    
    
    <title>CAS使用经验总结，纯干货 | 凝雨 - Yun | 快乐编程每一天 - Happy Coding Every Day</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="CAS,SLO,Single Logout,Ticket,Ticket Registry,Session Centralized Storage,Cookie,CAS Cluster,CAS Server,SSL,Cert">
    <meta name="description" content="CAS使用经验总结，纯干货">
<meta name="keywords" content="CAS,SLO,Single Logout,Ticket,Ticket Registry,Session Centralized Storage,Cookie,CAS Cluster,CAS Server,SSL,Cert">
<meta property="og:type" content="article">
<meta property="og:title" content="CAS使用经验总结，纯干货">
<meta property="og:url" content="https://ningyu1.github.io/20180119/54-cas-server.html">
<meta property="og:site_name" content="凝雨 - Yun">
<meta property="og:description" content="CAS使用经验总结，纯干货">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://img.shields.io/github/release/ningyu1/cas-site.svg?style=social&label=Release">
<meta property="og:image" content="https://img.shields.io/github/stars/ningyu1/cas-site.svg?style=social&label=Star">
<meta property="og:image" content="https://img.shields.io/github/forks/ningyu1/cas-site.svg?style=social&label=Fork">
<meta property="og:image" content="https://img.shields.io/github/watchers/ningyu1/cas-site.svg?style=social&label=Watch">
<meta property="og:image" content="https://img.shields.io/badge/license-GPLv3-blue.svg">
<meta property="og:image" content="https://img.shields.io/github/release/ningyu1/redis-client.svg?style=social&label=Release">
<meta property="og:image" content="https://img.shields.io/github/stars/ningyu1/redis-client.svg?style=social&label=Star">
<meta property="og:image" content="https://img.shields.io/github/forks/ningyu1/redis-client.svg?style=social&label=Fork">
<meta property="og:image" content="https://img.shields.io/github/watchers/ningyu1/redis-client.svg?style=social&label=Watch">
<meta property="og:image" content="https://img.shields.io/badge/license-GPLv3-blue.svg">
<meta property="og:updated_time" content="2024-04-23T01:48:15.035Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CAS使用经验总结，纯干货">
<meta name="twitter:description" content="CAS使用经验总结，纯干货">
<meta name="twitter:image" content="https://img.shields.io/github/release/ningyu1/cas-site.svg?style=social&label=Release">
    
        <link rel="alternate" type="application/atom+xml" title="凝雨 - Yun" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">凝雨</h5>
          <a href="mailto:ningbe111@163.com" title="ningbe111@163.com" class="mail">ningbe111@163.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                Home
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives/"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories/"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags/"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/ningyu1" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/about/"  >
                <i class="icon icon-lg icon-user"></i>
                About
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                Rss
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://g2.okk.dog/?path=register&code=qn7nOwdj" target="_blank" >
                <i class="icon icon-lg icon-rocket"></i>
                科学上网
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">CAS使用经验总结，纯干货</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">CAS使用经验总结，纯干货</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-01-19T08:25:36.000Z" itemprop="datePublished" class="page-time">
  2018-01-19
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/CAS/">CAS</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>文章目录</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#证书问题"><span class="post-toc-number">1.</span> <span class="post-toc-text">证书问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Client接入配置"><span class="post-toc-number">2.</span> <span class="post-toc-text">Client接入配置</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#SLO（Single-Logout）"><span class="post-toc-number">3.</span> <span class="post-toc-text">SLO（Single Logout）</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#CAS-callback回调问题"><span class="post-toc-number">4.</span> <span class="post-toc-text">CAS callback回调问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Cookie问题"><span class="post-toc-number">5.</span> <span class="post-toc-text">Cookie问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#举个例子理解一下"><span class="post-toc-number">5.1.</span> <span class="post-toc-text">举个例子理解一下</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#用户数据源以及认证问题"><span class="post-toc-number">6.</span> <span class="post-toc-text">用户数据源以及认证问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#CAS-Server-Ticket持久化问题"><span class="post-toc-number">7.</span> <span class="post-toc-text">CAS Server Ticket持久化问题</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Client-Server集群模式下session问题"><span class="post-toc-number">8.</span> <span class="post-toc-text">Client Server集群模式下session问题</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#WEB服务端session集中存储处理"><span class="post-toc-number">8.1.</span> <span class="post-toc-text">WEB服务端session集中存储处理</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-54-cas-server"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">CAS使用经验总结，纯干货</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-01-19 16:25:36" datetime="2018-01-19T08:25:36.000Z"  itemprop="datePublished">2018-01-19</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/CAS/">CAS</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>最近在处理公司项目对接到CAS server，在使用CAS发生了很多问题，下面整理一下遇到的问题与解决方式，希望可以帮助到需要的工程师们</p>
<p>CAS它是什么？它能做什么？这些我就不概述了，自行去搜索了解，<a href="https://baike.baidu.com/item/CAS/1329561" target="_blank" rel="noopener">https://baike.baidu.com/item/CAS/1329561</a></p>
<p>我们在使用CAS的时候基本都会遇到如下的几种问题：</p>
<ol>
<li>证书问题</li>
<li>Client接入配置</li>
<li>SLO（Single Logout）</li>
<li>CAS callback回调问题</li>
<li>Cookie问题</li>
<li>用户数据源以及认证问题</li>
<li>CAS Server Ticket持久化问题</li>
<li>Client Server集群模式下session问题</li>
</ol>
<p>还有一些是公司内部项目框架集成问题这里就不多说了。</p>
<p><strong>以下总结都是基于CAS v5.0.4版本测试</strong></p>
<p>我用的CAS Server是通过overlays改造后的项目，为什么需要修改原有的CAS Server呢？</p>
<p>我相信每个公司都有一些特殊的需求比如说：</p>
<ol>
<li>对登录页面的修改</li>
<li>自有的密码加密验证方式</li>
<li>新老项目架构参差不齐</li>
<li>使用公司自有用户数据源</li>
</ol>
<p>等等很多问题都需要对CAS Server进行改造</p>
<p>这里我将改造的CAS Server放到github上：</p>
<p>项目地址：<a href="https://github.com/ningyu1/cas-site" target="_blank" rel="noopener">cas-site</a></p>
<p><a href="https://github.com/ningyu1/cas-site/releases" target="_blank" rel="noopener"><img src="https://img.shields.io/github/release/ningyu1/cas-site.svg?style=social&amp;label=Release"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/stargazers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/stars/ningyu1/cas-site.svg?style=social&amp;label=Star"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/fork" target="_blank" rel="noopener"><img src="https://img.shields.io/github/forks/ningyu1/cas-site.svg?style=social&amp;label=Fork"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/watchers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/watchers/ningyu1/cas-site.svg?style=social&amp;label=Watch"></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg"></a></p>
<p>下面具体说一下上述的问题将如何来分析并解决</p>
<h1 id="证书问题"><a href="#证书问题" class="headerlink" title="证书问题"></a>证书问题</h1><p>如果你的服务不打算使用SSL那请跳过这段说明。</p>
<p>一般公司项目会有很多域名大概都是子域名的方式，例如：account.xxxx.com,login.xxxx.com，那么最好使用通配符证书，为什么呢？这样你的cas server上配置一个通配符证书即可，如果没有使用通配符证书那cas server上要配置所有授信域名的证书，这样就很麻烦，除非一些历史问题没办法才会导入多个证书，一般使用通配符证书。</p>
<p>我使用的是自签名的通配符证书，具体自签名证书如何生成可以查看我之前写的文章：</p>
<p><a href="https://ningyu1.github.io/site/post/51-ssl-cert/">《Openssl生成自签名证书，简单步骤》</a>中讲述了如何生成自签名证书。</p>
<p><a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a>中讲述了如何使用自签名证书。</p>
<p><a href="https://ningyu1.github.io/site/post/51-ssl-cert-3/">《Java访问SSL地址，使用证书方式和免验证证书方式》</a>中讲述了Java访问ssl使用证书方式和免验证证书方式。</p>
<p><span style="color:red"><strong>ps.这里需要注意的是在制作单域名证书和通配符域名证书的区别是在：Common Name输入的时候，例如：</strong></span></p>
<p>单域名证书：<code>Common Name：account.xxxx.ccom</code><br>通配符域名证书：<code>Common Name：*.xxxx.com</code></p>
<p>将制作好的证书文件通过keytool导入到jdk下即可，或使用InstallCert来生成文件copy到jdk下，具体可以参考文章：<a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a></p>
<p>证书放在：<code>%JAVA_HOME%\jre\lib\security</code></p>
<p>我们cas server使用的jdk1.8，client服务大多是jdk1.7，因此在证书处理上要注意这个细节，上面文章中有明确说明</p>
<p><span style="color:red"><strong>如果需要使用Docker构建，可以参考我写好的Dockerfile，在cas-site项目下Dockerfile文件</strong></span></p>
<h1 id="Client接入配置"><a href="#Client接入配置" class="headerlink" title="Client接入配置"></a>Client接入配置</h1><p>接入cas的client端配置非常简单，可以使用spring framework对接cas方式，也可以使用spring security对接cas方式，或者其他支持cas的第三方框架，自己对接配置非常简单只需要配置<code>SingleSignOutFilter</code>和<code>SingleSignOutHttpSessionListener</code></p>
<ul>
<li>org.jasig.cas.client.session.SingleSignOutFilter：解决Logout清空TGC和session信息</li>
<li>org.jasig.cas.client.session.SingleSignOutHttpSessionListener：session监听</li>
</ul>
<p>这里在对接方面就不做过多的介绍了。</p>
<h1 id="SLO（Single-Logout）"><a href="#SLO（Single-Logout）" class="headerlink" title="SLO（Single Logout）"></a>SLO（Single Logout）</h1><p>SLO是个什么？</p>
<p>通俗点讲就是：浏览器多个tab页开启不同的APP（使用同一个用户登录），在某一个APP里进行登出操作，其余APP应该一起登出</p>
<p>CAS Server默认是开启SLO功能，如果想要关闭这个功能可以通过设置<code>application.properties</code>文件中的参数来关闭，具体如下：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 是否禁用SLO功能，true为禁用SLO功能</span><br><span class="line">cas.slo.disabled=true</span><br><span class="line"># 使用采用异步方式进行callback</span><br><span class="line">cas.slo.asynchronous=true</span><br></pre></td></tr></table></figure>
<p><span style="color:red"><strong>这里需要注意Logout时服务重定向需要开启：</strong></span></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Logout时服务重定向</span><br><span class="line">cas.logout.followServiceRedirects=true</span><br></pre></td></tr></table></figure>
<p>CAS Server在进行异步回调时会忽略所有的错误来保证所有APP都能接收到Server发出的logout请求，因此在遇到错误时不开启trace级别日志是看不到错误信息的。</p>
<p>如果你的client端能看到接下来的章节（CAS callback回调问题） 说到的日志信息那就证明回调是没有问题的。</p>
<h1 id="CAS-callback回调问题"><a href="#CAS-callback回调问题" class="headerlink" title="CAS callback回调问题"></a>CAS callback回调问题</h1><p>CAS认证过程需要server端和client端来回调用，如果发现callback回调有问题多半是第一步证书问题导致，可以开启日志trace级别查看cas的日志来排除问题。</p>
<p>cas回调有三种情况:</p>
<p>一个是授权的时候进行回调信息如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2018-01-19 11:44:28.419 [http-apr-8080-exec-9] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Received a token request</span><br><span class="line">2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG org.jasig.cas.client.session.SingleSignOutHandler - Recording session for token ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608</span><br><span class="line">2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Attempting to remove Session=[8F24552DD446F669B7A522B1A8A0C86D]</span><br><span class="line">2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - No mapping for session found.  Ignoring.</span><br><span class="line">2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Placing URL parameters in map.</span><br><span class="line">2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Calling template URL attribute map.</span><br><span class="line"></span><br><span class="line">2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Loading custom parameters from configuration.</span><br><span class="line">2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Constructing validation url: https://login.dev.xxx.com.cn/serviceValidate?ticket=ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608&amp;service=https%3A%2F%2Faccount.dev.xxx.com.cn%2Fcas_security_check_</span><br><span class="line">2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Retrieving response from server.</span><br><span class="line">2018-01-19 11:44:28.460 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Server response: &lt;cas:serviceResponse xmlns:cas=&apos;http://www.yale.edu/tp/cas&apos;&gt;</span><br><span class="line">    &lt;cas:authenticationSuccess&gt;</span><br><span class="line">        &lt;cas:user&gt;admin&lt;/cas:user&gt;</span><br><span class="line">        &lt;/cas:authenticationSuccess&gt;</span><br><span class="line">&lt;/cas:serviceResponse&gt;</span><br></pre></td></tr></table></figure>
<p>一个是SLO时清理session的回调信息如下</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">2018-01-19 11:44:45.484 [http-apr-8080-exec-5] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Received a back channel logout request</span><br><span class="line">2018-01-19 11:44:45.484 [http-apr-8080-exec-5] DEBUG org.jasig.cas.client.util.CommonUtils - safeGetParameter called on a POST HttpServletRequest for Restricted Parameters.  Cannot complete check safely.  Reverting to standard behavior for this Parameter</span><br><span class="line">2018-01-19 11:44:45.485 [http-apr-8080-exec-5] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Logout request:</span><br><span class="line">&lt;samlp:LogoutRequest xmlns:samlp=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot; ID=&quot;LR-79-M3OyvVsRH7Ft1gRVaBfeuBCAj4K1JEDnndt&quot; Version=&quot;2.0&quot; IssueInstant=&quot;2018-01-19T11:44:45Z&quot;&gt;&lt;saml:NameID xmlns:saml=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;&gt;@NOT_USED@&lt;/saml:NameID&gt;&lt;samlp:SessionIndex&gt;ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608&lt;/samlp:SessionIndex&gt;&lt;/samlp:LogoutRequest&gt;</span><br><span class="line">2018-01-19 11:44:45.485 [http-apr-8080-exec-5] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Attempting to remove Session=[8F24552DD446F669B7A522B1A8A0C86D]</span><br><span class="line">2018-01-19 11:44:45.485 [http-apr-8080-exec-5] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Found mapping for session.  Session Removed.</span><br><span class="line">2018-01-19 11:44:45.486 [http-apr-8080-exec-5] DEBUG org.jasig.cas.client.session.SingleSignOutHandler - Invalidating session [8F24552DD446F669B7A522B1A8A0C86D] for token [ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608]</span><br></pre></td></tr></table></figure>
<p>还有一种也是SLO时清理session的回调和上面的有什么区别呢？</p>
<p>上面的SLO是back channel logout方式，还有一种方式：front channel logout，后者是cas新版本提供的新方式，我这里没有使用，具体可以参考官方说明：<a href="https://apereo.github.io/cas/5.0.x/installation/Logout-Single-Signout.html#turning-off-single-logout" target="_blank" rel="noopener">https://apereo.github.io/cas/5.0.x/installation/Logout-Single-Signout.html#turning-off-single-logout</a></p>
<p>开启trace日志查看回调是否发生错误来解决回调不生效问题</p>
<h1 id="Cookie问题"><a href="#Cookie问题" class="headerlink" title="Cookie问题"></a>Cookie问题</h1><p>当使用单个域名时会出现Cookie清理问题从而导致SLO失效，因为CAS Server生成TGC时如果不设置cookie domain它会写在对接的service所在的域名下，最好的方式是让Cookie写在根域名的根Path（/）下，在CAS server端配置TGC的domain以及其他cookie参数，具体参考：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cas.tgc.path=/</span><br><span class="line">cas.tgc.maxAge=-1</span><br><span class="line">cas.tgc.domain=your.domain.com</span><br><span class="line">#cas.tgc.signingKey=</span><br><span class="line">cas.tgc.name=TGC</span><br><span class="line">#cas.tgc.encryptionKey=</span><br><span class="line">cas.tgc.secure=true</span><br><span class="line">cas.tgc.httpOnly=true</span><br><span class="line">cas.tgc.rememberMeMaxAge=1209600</span><br><span class="line">cas.tgc.cipherEnabled=true</span><br></pre></td></tr></table></figure>
<p>具体说明查看官方文档：<a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html#ticket-granting-cookie" target="_blank" rel="noopener">https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html#ticket-granting-cookie</a></p>
<h2 id="举个例子理解一下"><a href="#举个例子理解一下" class="headerlink" title="举个例子理解一下"></a>举个例子理解一下</h2><p>我有三个APP域名分别为：<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https://account.domain.com</span><br><span class="line">https://login.domain.com</span><br><span class="line">https://app.domain.com</span><br></pre></td></tr></table></figure></p>
<p>我生成的通配符证书域名为：<code>*.domain.com</code></p>
<p>我三个APP在部署时jdk下放通配符域名证书</p>
<p>这样修改tgc配置为：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># cookie写的路径 / 为根域名下</span><br><span class="line">cas.tgc.path=/</span><br><span class="line"># cookie有效期，-1 为关闭浏览器自动清空</span><br><span class="line">cas.tgc.maxAge=-1</span><br><span class="line"># cookie写在那个域名下</span><br><span class="line">cas.tgc.domain=domain.com</span><br><span class="line"># cookie的名称</span><br><span class="line">cas.tgc.name=TGC</span><br><span class="line"># cookie开启器安全模式ssl</span><br><span class="line">cas.tgc.secure=true</span><br><span class="line"># cookie禁止js调用</span><br><span class="line">cas.tgc.httpOnly=true</span><br><span class="line"># 这两个采用默认配置即可</span><br><span class="line">cas.tgc.rememberMeMaxAge=1209600</span><br><span class="line">cas.tgc.cipherEnabled=true</span><br></pre></td></tr></table></figure>
<h1 id="用户数据源以及认证问题"><a href="#用户数据源以及认证问题" class="headerlink" title="用户数据源以及认证问题"></a>用户数据源以及认证问题</h1><p>CAS在这方面留了很多扩展的地方，而且很方便的配置就可以支持自定义</p>
<p>数据源支持的方式也有很多种（jdbc、mongodb、RestStorage、GIT、等）这里就不一一介绍了<br>认证方式支持的方式也很多种（Basic、OAuth2.0|1.0、Google Authenticator、LDAP、REST、OpenID、SPNEGO、等）这里就不一一介绍了</p>
<p>具体可以查看官方说明对应的配置：<a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html" target="_blank" rel="noopener">https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html</a></p>
<p>我使用的是jdbc方式</p>
<p>具体可以去github上查看cas-site源码：<a href="https://github.com/ningyu1/cas-site" title="项目地址" target="_blank" rel="noopener">cas-site</a> </p>
<h1 id="CAS-Server-Ticket持久化问题"><a href="#CAS-Server-Ticket持久化问题" class="headerlink" title="CAS Server Ticket持久化问题"></a>CAS Server Ticket持久化问题</h1><p>Ticket持久化方式也有很多中（JPA、Couchbase、Hazelcast、Infinispan、InMemory、Ehcache、Ignite、Memcached），默认方式（inMemory基于内存的），下面我给出JAP方式的配置参数：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cas.ticket.registry.jpa.jpaLockingTimeout=3600</span><br><span class="line">cas.ticket.registry.jpa.healthQuery=SELECT 1</span><br><span class="line">cas.ticket.registry.jpa.isolateInternalQueries=false</span><br><span class="line">cas.ticket.registry.jpa.url=jdbc:mysql://127.0.0.1:3306/cas?useUnicode=true&amp;characterEncoding=UTF-8&amp;noAccessToProcedureBodies=true</span><br><span class="line">cas.ticket.registry.jpa.failFast=true</span><br><span class="line">cas.ticket.registry.jpa.dialect=org.hibernate.dialect.MySQL5Dialect</span><br><span class="line">cas.ticket.registry.jpa.leakThreshold=10</span><br><span class="line">cas.ticket.registry.jpa.jpaLockingTgtEnabled=false</span><br><span class="line">cas.ticket.registry.jpa.batchSize=1</span><br><span class="line">#cas.ticket.registry.jpa.defaultCatalog=</span><br><span class="line">cas.ticket.registry.jpa.defaultSchema=cas</span><br><span class="line">cas.ticket.registry.jpa.user=root</span><br><span class="line">cas.ticket.registry.jpa.ddlAuto=validate</span><br><span class="line">cas.ticket.registry.jpa.password=root@123456</span><br><span class="line">cas.ticket.registry.jpa.autocommit=true</span><br><span class="line">cas.ticket.registry.jpa.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">cas.ticket.registry.jpa.idleTimeout=5000</span><br><span class="line"></span><br><span class="line"># 下面的参数根据实际情况选择使用</span><br><span class="line"># 连接池</span><br><span class="line"># cas.ticket.registry.jpa.pool.suspension=false</span><br><span class="line"># cas.ticket.registry.jpa.pool.minSize=6</span><br><span class="line"># cas.ticket.registry.jpa.pool.maxSize=18</span><br><span class="line"># cas.ticket.registry.jpa.pool.maxWait=2000</span><br><span class="line"># 签名与数据加解密密钥和算法</span><br><span class="line"># cas.ticket.registry.jpa.crypto.signing.key=</span><br><span class="line"># cas.ticket.registry.jpa.crypto.signing.keySize=512</span><br><span class="line"># cas.ticket.registry.jpa.crypto.encryption.key=</span><br><span class="line"># cas.ticket.registry.jpa.crypto.encryption.keySize=16</span><br><span class="line"># cas.ticket.registry.jpa.crypto.alg=AES</span><br></pre></td></tr></table></figure>
<p>这里需要注意的是，以上给出的配置参数是建议值，ddlauto默认值是create-drop，可选值有（create、create-drop、validate、update），具体含义可以查看官方文档：<a href="https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html" target="_blank" rel="noopener">https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html</a>，建议使用validate的方式，使用validate需要自己创建表，一共四张表下面贴出建表语句：</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `locks` (</span><br><span class="line">`application_id` varchar(255) NOT NULL,</span><br><span class="line">`expiration_date` datetime DEFAULT NULL,</span><br><span class="line">`unique_id` varchar(255) DEFAULT NULL,</span><br><span class="line">`lockVer` int(11) NOT NULL DEFAULT &apos;0&apos;,</span><br><span class="line">PRIMARY KEY (`application_id`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">CREATE TABLE `oauth_tokens` (</span><br><span class="line">`TYPE` varchar(31) NOT NULL,</span><br><span class="line">`ID` varchar(255) NOT NULL,</span><br><span class="line">`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,</span><br><span class="line">`CREATION_TIME` datetime DEFAULT NULL,</span><br><span class="line">`EXPIRATION_POLICY` longblob NOT NULL,</span><br><span class="line">`LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`AUTHENTICATION` longblob NOT NULL,</span><br><span class="line">`SERVICE` longblob NOT NULL,</span><br><span class="line">PRIMARY KEY (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line"></span><br><span class="line">CREATE TABLE `serviceticket` (</span><br><span class="line">`TYPE` varchar(31) NOT NULL,</span><br><span class="line">`ID` varchar(255) NOT NULL,</span><br><span class="line">`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,</span><br><span class="line">`CREATION_TIME` datetime DEFAULT NULL,</span><br><span class="line">`EXPIRATION_POLICY` longblob NOT NULL,</span><br><span class="line">`LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`FROM_NEW_LOGIN` bit(1) NOT NULL,</span><br><span class="line">`TICKET_ALREADY_GRANTED` bit(1) NOT NULL,</span><br><span class="line">`SERVICE` longblob NOT NULL,</span><br><span class="line">`ticketGrantingTicket_ID` varchar(255) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (`ID`),</span><br><span class="line">KEY `FK60oigifivx01ts3n8vboyqs38` (`ticketGrantingTicket_ID`),</span><br><span class="line">CONSTRAINT `FK60oigifivx01ts3n8vboyqs38` FOREIGN KEY (`ticketGrantingTicket_ID`) REFERENCES `ticketgrantingticket` (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br><span class="line"></span><br><span class="line">CREATE TABLE `ticketgrantingticket` (</span><br><span class="line">`TYPE` varchar(31) NOT NULL,</span><br><span class="line">`ID` varchar(255) NOT NULL,</span><br><span class="line">`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,</span><br><span class="line">`CREATION_TIME` datetime DEFAULT NULL,</span><br><span class="line">`EXPIRATION_POLICY` longblob NOT NULL,</span><br><span class="line">`LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,</span><br><span class="line">`AUTHENTICATION` longblob NOT NULL,</span><br><span class="line">`EXPIRED` bit(1) NOT NULL,</span><br><span class="line">`PROXIED_BY` longblob,</span><br><span class="line">`SERVICES_GRANTED_ACCESS_TO` longblob NOT NULL,</span><br><span class="line">`ticketGrantingTicket_ID` varchar(255) DEFAULT NULL,</span><br><span class="line">PRIMARY KEY (`ID`),</span><br><span class="line">KEY `FKiqyu3qw2fxf5qaqin02mox8r4` (`ticketGrantingTicket_ID`),</span><br><span class="line">CONSTRAINT `FKiqyu3qw2fxf5qaqin02mox8r4` FOREIGN KEY (`ticketGrantingTicket_ID`) REFERENCES `ticketgrantingticket` (`ID`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8</span><br></pre></td></tr></table></figure>
<p>其他参数含义可以查看官方配置说明：<a href="https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html" target="_blank" rel="noopener">https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html</a></p>
<h1 id="Client-Server集群模式下session问题"><a href="#Client-Server集群模式下session问题" class="headerlink" title="Client Server集群模式下session问题"></a>Client Server集群模式下session问题</h1><p>当我们CAS Server准备好后，就要处理Client接入的问题，如果我们的Client服务是单机模式那没有任何问题，一旦放到集群环境下就会发生如下有意思的事情。</p>
<p>我前面说了CAS在授权回调时会做几件事，第一TG保存到Cookie，第二个保存ticketid对应的session关系以及session对象。</p>
<p>那么如果我们的Client服务是集群的会发生什么？</p>
<p>举个例子：</p>
<p>我的APP服务部署了2台服务（S1、S2）采用loadbalance映射一个域名出去访问，当CAS授权回调时被loadbalance路由到S1上，SingleSignOutFilter以及SingleSignOutHandler进行了TGC和SessionMappingStorage，默认的持久化方式是hash的方式，也就是说本地map方式，这样在下次访问到APP时被loadbalance路由到S2上就会发生什么有意思的事情呢？我相信做过分布式服务的应该都能猜出来什么问题。</p>
<p>APP：我没找到cas认证信息，跳转到cas login页面</p>
<p>CAS：我找到了你APP已经做过认证了，跳转到APP并且给你上次认证的ticlet</p>
<p>APP：我真没找到你的认证信息，跳转到cas login页面</p>
<p>CAS：你真的已经做过认证了，跳转到APP并且给你上次认证的ticlet</p>
<p>这样就会发生无线跳转死循环问题。</p>
<p>那如何解决上面的问题呢？</p>
<p>在分布式的环境下几乎服务都是集群的，甚至有很多公司会做异地多活等等。那么在集群环境下如何解决cas授权持久化的问题呢？很简单重新实现一个cas-client的SessionMappingStorage，这里可以使用很多方式，比如说：放到db、nosql的存储上（mongodb、redis）、memcache、分布式文件存储都可以。</p>
<p>我这里采用的是redis，而且我们dev和qa环境采用单机模式，stage和prod环境使用集群模式，因此我还做了集群和本地都兼容的方式，话不多说直接贴出实现代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line">import org.jasig.cas.client.session.SessionMappingStorage;</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import xxxxxxxx.framework.redis.client.IRedisClient;</span><br><span class="line"></span><br><span class="line">public class RedisBackedSessionMappingStorage implements SessionMappingStorage &#123;</span><br><span class="line">    </span><br><span class="line">    private final Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * Maps the ID from the CAS server to the Session.</span><br><span class="line">     */</span><br><span class="line">    private final Map&lt;String, HttpSession&gt; MANAGED_SESSIONS = new HashMap&lt;String, HttpSession&gt;();</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * Maps the Session ID to the key from the CAS Server.</span><br><span class="line">     */</span><br><span class="line">    private final Map&lt;String, String&gt; ID_TO_SESSION_KEY_MAPPING = new HashMap&lt;String, String&gt;();</span><br><span class="line">    </span><br><span class="line">    private final static String NAME_SPACE = &quot;CAS&quot;;</span><br><span class="line">    </span><br><span class="line">    private IRedisClient redisClient;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 在dev和qa环境使用单机模式：hash</span><br><span class="line">     * 在stage和prod环境使用集群模式：redis</span><br><span class="line">     */</span><br><span class="line">    private String storageMode = &quot;hash&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 redisClient</span><br><span class="line">     * @return the redisClient</span><br><span class="line">     */</span><br><span class="line">    public IRedisClient getRedisClient() &#123;</span><br><span class="line">        return redisClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置 redisClient</span><br><span class="line">     * @param redisClient the redisClient to set</span><br><span class="line">     */</span><br><span class="line">    public void setRedisClient(IRedisClient redisClient) &#123;</span><br><span class="line">        this.redisClient = redisClient;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取 storageMode</span><br><span class="line">     * @return the storageMode</span><br><span class="line">     */</span><br><span class="line">    public String getStorageMode() &#123;</span><br><span class="line">        return storageMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 设置 storageMode</span><br><span class="line">     * @param storageMode the storageMode to set</span><br><span class="line">     */</span><br><span class="line">    public void setStorageMode(String storageMode) &#123;</span><br><span class="line">        this.storageMode = storageMode;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public HttpSession removeSessionByMappingId(String mappingId) &#123;</span><br><span class="line">        HttpSession session = null;</span><br><span class="line">        if (storageMode.equals(&quot;hash&quot;)) &#123;</span><br><span class="line">            session = MANAGED_SESSIONS.get(mappingId);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            session = redisClient.get(mappingId, NAME_SPACE, HttpSession.class, null);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (session != null) &#123;</span><br><span class="line">            removeBySessionById(session.getId());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        return session;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void removeBySessionById(String sessionId) &#123;</span><br><span class="line">        logger.debug(&quot;Attempting to remove Session=[&#123;&#125;]&quot;, sessionId);</span><br><span class="line">        String key = null;</span><br><span class="line">        if (storageMode.equals(&quot;hash&quot;)) &#123;</span><br><span class="line">            key = ID_TO_SESSION_KEY_MAPPING.get(sessionId);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            key = redisClient.get(sessionId, NAME_SPACE, null);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (logger.isDebugEnabled()) &#123;</span><br><span class="line">            if (key != null) &#123;</span><br><span class="line">                logger.debug(&quot;Found mapping for session.  Session Removed.&quot;);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                logger.debug(&quot;No mapping for session found.  Ignoring.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        if (storageMode.equals(&quot;hash&quot;)) &#123;</span><br><span class="line">            MANAGED_SESSIONS.remove(key);</span><br><span class="line">            ID_TO_SESSION_KEY_MAPPING.remove(sessionId);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            redisClient.del(key, NAME_SPACE);</span><br><span class="line">            redisClient.del(sessionId, NAME_SPACE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void addSessionById(String mappingId, HttpSession session) &#123;</span><br><span class="line">        if (storageMode.equals(&quot;hash&quot;)) &#123;</span><br><span class="line">            ID_TO_SESSION_KEY_MAPPING.put(session.getId(), mappingId);</span><br><span class="line">            MANAGED_SESSIONS.put(mappingId, session);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            redisClient.set(session.getId(), NAME_SPACE, mappingId, -1);</span><br><span class="line">            redisClient.set(mappingId, NAME_SPACE, session, -1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用的redis-client是我自己封装，使用文档在：<a href="https://ningyu1.github.io/site/post/22-redis-client/">《RedisClient使用说明》</a>，支持redis集群模式：<a href="https://ningyu1.github.io/site/post/28-redis-client-sentinel/">《RedisClient升级支持Sentinel使用说明》</a>，代码已经放到了github上：</p>
<p>项目地址：<a href="https://github.com/ningyu1/redis-client" target="_blank" rel="noopener">redis-client</a></p>
<p><a href="https://github.com/ningyu1/redis-client/releases" target="_blank" rel="noopener"><img src="https://img.shields.io/github/release/ningyu1/redis-client.svg?style=social&amp;label=Release"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/stargazers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/stars/ningyu1/redis-client.svg?style=social&amp;label=Star"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/fork" target="_blank" rel="noopener"><img src="https://img.shields.io/github/forks/ningyu1/redis-client.svg?style=social&amp;label=Fork"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/watchers" target="_blank" rel="noopener"><img src="https://img.shields.io/github/watchers/ningyu1/redis-client.svg?style=social&amp;label=Watch"></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html" target="_blank" rel="noopener"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg"></a></p>
<p>把上面的<code>RedisBackedSessionMappingStorage</code>类注入到<code>org.jasig.cas.client.session.SingleSignOutFilter</code>中即可</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean id=&quot;singleLogoutFilter&quot; class=&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;sessionMappingStorage&quot; ref=&quot;redisBackedSessionMappingStorage&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;bean id=&quot;redisBackedSessionMappingStorage&quot; class=&quot;xxxxxxx.cas.session.storage.RedisBackedSessionMappingStorage&quot;&gt;</span><br><span class="line">	&lt;property name=&quot;redisClient&quot; ref=&quot;redisClient&quot;&gt;&lt;/property&gt;</span><br><span class="line">	&lt;property name=&quot;storageMode&quot; value=&quot;$&#123;cas.session.storage.mode&#125;&quot;&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p><span style="color:red"><strong>ps.参数cas.session.storage.mode，值：hash（本地map）、redis（集中存储）</strong></span></p>
<h2 id="WEB服务端session集中存储处理"><a href="#WEB服务端session集中存储处理" class="headerlink" title="WEB服务端session集中存储处理"></a>WEB服务端session集中存储处理</h2><p>WEB服务端session集中存储处理方案也有很多种，使用tomcat可以使用TomcatRedisSessionManager来解决session集中存储问题，github地址：<a href="https://github.com/ran-jit/tomcat-cluster-redis-session-manager" target="_blank" rel="noopener">https://github.com/ran-jit/tomcat-cluster-redis-session-manager</a></p>
<p>如果要自己实现也很简单，我这里大致说一下思路，需要包装一个可序列话的session，说白了就是包装一下session实现序列化接口：<code>java.io.Serializable</code>接口生成一个version id，包装一个获取器，在生成session的时候序列化写入集中存储返回id，在用的使用通过id获取，id可以使用jsessionid或者自己生成一个uuid都行。这个id可以放入浏览器cookie，也可以放入url每次带入,在登录成功后将session序列化存储到redis或其他cache、nosql、db等，在登出时清空即可，就看自己喜好来实现了。</p>
<p>到这里基本上对cas的使用经验就总结完了，我相信大家在使用cas时都会遇到上面的问题，希望这篇总结可以帮助到需要的人，感谢看到最后。</p>
<p>最后我的愿望是：世界和平，快乐编程每一天，keep real</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2024-04-23T01:48:15.035Z" itemprop="dateUpdated">2024-04-23 09:48:15</time>
</span><br>


        
        原始链接：<a href="/20180119/54-cas-server.html" target="_blank" rel="external">https://ningyu1.github.io/20180119/54-cas-server.html</a><br>版权声明：本文由 <strong>凝雨-Yun</strong> 原创，采用<strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a></strong>进行许可。 <br><strong>转载请注明作者及出处！</strong><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>
        
    </div>
    
    <footer>
        <a href="https://ningyu1.github.io">
            <img src="/img/avatar.jpg" alt="凝雨">
            凝雨
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CAS/">CAS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CAS-Cluster/">CAS Cluster</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CAS-Server/">CAS Server</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cert/">Cert</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cookie/">Cookie</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SLO/">SLO</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SSL/">SSL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Session-Centralized-Storage/">Session Centralized Storage</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Single-Logout/">Single Logout</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ticket/">Ticket</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Ticket-Registry/">Ticket Registry</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20180119/54-cas-server.html&title=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20180119/54-cas-server.html&title=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20180119/54-cas-server.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&url=https://ningyu1.github.io/20180119/54-cas-server.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20180119/54-cas-server.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/20180123/55-java-jvm-analysis.html" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">生产环境如何快速跟踪、分析、定位问题-Java</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/20180115/53-ssl-cert-3.html" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Java访问SSL地址，使用证书方式和免验证证书方式</h4>
      </a>
    </div>
  
</nav>



    

















<section class="comments" id="comments">
    <div id="gitalk-container"></div>
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>
        var id = location.pathname
        if (location.pathname.length > 50) {
          id = location.pathname.replace(/\/\d+\/\d+\/\d+\//, '').replace('/', '').substring(0, 50)
        }
        const gitalk = new Gitalk({
          clientID: '298f0d78bd14c9c0ff01',
          clientSecret: 'e81e4d36caf1a13d2f05ed5dcf30e636dde749ac',
          repo: 'blog',
          owner: 'ningyu1',
          admin: ['ningyu1'],
          id: id,      // Ensure uniqueness and length less than 50
	  //id: 'Comments',
          title: document.title.split('|')[0],
          distractionFreeMode: false  // Facebook-like distraction free mode
        })

        gitalk.render('gitalk-container')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        可以吃个鸡腿吗？
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>博客内容遵循 <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.zh">知识共享署名-相同方式共享 4.0 国际许可协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>凝雨 &copy; 2016 - 2024</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=https://ningyu1.github.io/20180119/54-cas-server.html&title=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&pic=https://ningyu1.github.io/img/avatar.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=https://ningyu1.github.io/20180119/54-cas-server.html&title=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&source=快乐编程每一天 - Happy Coding Every Day" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https://ningyu1.github.io/20180119/54-cas-server.html" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《CAS使用经验总结，纯干货》 — 凝雨 - Yun&url=https://ningyu1.github.io/20180119/54-cas-server.html&via=https://ningyu1.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=https://ningyu1.github.io/20180119/54-cas-server.html" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACJ0lEQVR42u3aQXLDIAwF0Nz/0ukBWjtfUtwZ4LHKxA7meaGApNcrHu9f4+rq1TfVp7yeGBgYGMsy3rejysiv9p57ScXAwDiAcRXBrj4nU18tK78nWRsGBgZG9Z78mx4bAwMDIw+4+bEzP5RiYGBg3DOSw2RyfxJS83TeI2dxDAyMBRl5KPz/z4/UNzAwMJZi9EJnHharh+HewMDA2JuRB7gJctIdUWjLwMDA2JTRKzE+1+BVPfqOKqUYGBjLMqoNEHlJYN7+dRnWMTAwtmYky8oPsZPZ7u+PiqMYGBjHMO6nyDGTF9ErdmJgYJzD6E2XFDur28dkQ/nKH4yBgbEsowrID5l5oEzayD78JWBgYGzNmATB3iJ6pYIo3YaBgXEAY5K4T95N9bdJuC88BgMDY3HGJJVffR3V4F4I0xgYGJsy8qDWS4Ql8/Qwf/SMYGBgbM3Il54E2WQj2Av9H7KGGBgYBzMm2btJE1ih2QIDA2NrRi9olkuJxRJp76CLgYGxN+NbebuktNnbhkYhGwMD4wDGpDtjkpirXr18uRgYGAcwCqGt2DpW3Qg2C64YGBibMt7FkS/ru0WFD2wMDIytGdUwN98+9poqJq8JAwNjD0YSZKsFxV5RMypSYmBgHMyoNmk9l4DLQz8GBgZGfoCcHDsLIXUyEQYGxvGMHrVZqvzu1hADA2MpRv6YXhquh3wk3YaBgbEgY9SpUUylVe+stoBgYGBsx/gBp7xqmPrGUQYAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-indigo-patch@1.0.0/source/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>










</body>
</html>
